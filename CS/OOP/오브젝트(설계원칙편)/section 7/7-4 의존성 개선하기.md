# 의존성 개선하기
## 이해하기 어려운 테스트
```java
public class GameTest{
    @Test
    public void move_north_passed(){
        //테스트 입력과 출력 사이의 관계가 모호함
        OutputStream output = new ByteArrayOutputStream();
        // Scanner, System과 Game사이의 의존성이 암묵적
        System.setOut(new PrintStream(output));
        System.setIn(new ByteArrayInputStream("go north\nquit\n".getBytes()));

        Game game = new Game();
        game.run();

        assertThat(output.toString().split("\n")).containsSequence(
            "> 당신은 [다리]에 있습니다.",
            "큰 강 위에 돌로 만든 커다란 다리가 있습니다.",
            "> ",
            "게임을 종료합니다.";
        )
    }
}
```

현재 Game은 상위 수준 정책이 하위 수준 메커니즘에 의존중 -> 의존성 역전 원칙 적용하기
```java
public class Game{
    private Player player;
    private CommandPlayer commandParser;
    private InputOutput io;
    private boolean running;

    public Game(InputOutput io){
        this.player = new Player(...);
        this.commandParser = new CommandParser();
        this.io = io;
    }
    
    private String inputCommand(Scanner scanner){
        showPrompt();
        return input(scanner);
    }

    private String input(Scanner scanner){
        return io.input();
    }

    private void farewell(){
        io.showLine("\n게임을 종료합니다.");
    }

    private void showPrompt(){
        io.show("> ");
    }
}

public interface InputOutput{
    String input();
    void showLine(String text);
    void show(String text)
}

public class Console implements InputOutput{
    private Scanner scanner;

    public Console(){
        this.scanner = new Scanner(System.in);
    }

    @Override
    public String input(){
        return scanner.nextLine().toLowerCase().trim();
    }

    @Override
    public void showLine(String text){
        System.out.println(text);
    }

    @Override
    public void show(String text){
        System.out.print(text);
    }
}


public class Main{
    public static void main(String[] args){
        InputOutput io = new Console(); // 여기서 생성해서 의존성 주입
    }
}

```

## 외부 의존성과 테스트
제어하기 쉬운 내부 의존성과 제어하기 어려운 외부 의존성이 하나의 클래스 안에 함께 포함되어 있다면 테스트가 어려워진다.

`외부 의존성을 별도의 클래스로 분리해서 의존성을 명시적으로 드러내라.`