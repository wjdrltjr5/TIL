# 값 객체의 가치

## 값 객체
값이 동일하면 동일한 객체로 취급 값 비교를 통해 참조 객체의 복잡성 감소 불변 객체로 구현

값객체의 상태의 변경은 기존 인스턴스를 변경하지 않고 새로운 객체를 반환
```java
// 불변 Money 값 객체
public class Money {
    public static final Money ZERO = Money.wons(0);

    private final BigDecimal amount;

    public static Money wons(long amount) {
        return new Money(BigDecimal.valueOf(amount));
    }

    Money(BigDecimal amount) {
        this.amount = amount;
    }

    public double doubleValue() {
        return amount.doubleValue();
    }

    public Money plus(Money amount) {
        return new Money(this.amount.add(amount.amount));
    }

    public Money minus(Money amount) {
        return new Money(this.amount.subtract(amount.amount));
    }

    public Money times(double times) {
        return new Money(this.amount.multiply(BigDecimal.valueOf(times)));
    }

    public Money ceil(double percent) {
        return new Money(this.amount.multiply(BigDecimal.valueOf(percent)).setScale(0, RoundingMode.CEILING));
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Money money = (Money) o;
        return Objects.equals(amount, money.amount);
    }

    @Override
    public int hashCode() {
        return Objects.hashCode(amount);
    }

    @Override
    public String toString() {
        return amount.toString() + "원";
    }
}
```

값 객체가 참조객체보다 복잡성이 낮은 이유는 상태의 변경을 이해하기가 더 쉽고 다른 클라이언트의 변경에 영향을 받지 않음

![alt text](<값객체.png>)

상태 추적과 예상하지 못한 부수효과에 대한 걱정 없이 사용

- 참조 객체
    - 식별자를 기반으로 객체 동일성 체크
    - 가변 객체로 구현 
    - 별칭 문제 발생
- 값 객체
    - 속성을 기반으로 객체 동등성 체크
    - 불변 객체로 구현
    - 별칭 문제 방지
### 값 객체의 가치
참조 객체 안에 숨겨진 모호한 개념을 명시적으로 드러내서 복잡성 감소, 참조 객체 안의 복잡한 로직이나 중복 코드를 값 객체로 이동

#### 암시적인 개념을 명시적으로 드러내기
long 타입 안에 숨겨져있는 금액이라는 개념을 드러냄 + 메서드 내부에 숨겨져 있는 금액 계산 로직

```java
// 불변 Money 값 객체
public class Money {
    ...
    public Money plus(Money amount) {
        return new Money(this.amount.add(amount.amount));
    }

    public Money minus(Money amount) {
        return new Money(this.amount.subtract(amount.amount));
    }

    public Money times(double times) {
        return new Money(this.amount.multiply(BigDecimal.valueOf(times)));
    }
    ...
}
```

#### 중복 로직을 값 객체로 이동
금액을 올림 로직을 값객체로 이동 (DRY 원칙)
```java
// Game과 Sales에서 공통적으로 사용하는 금액 올림 로직을 값객체로 이동
public class Money {
    ...
    public Money ceil(double percent) {
        return new Money(this.amount.multiply(BigDecimal.valueOf(percent)).setScale(0, RoundingMode.CEILING));
    }
    ...
}
```

### 값 객체는 합성 관계로 연결
값 객체는 포함하는 객체의 생명주기에 종속 (속성으로 표현하는 것이 더 식별하기 쉽다.)


### 값 객체 설계
- 일반적인 하항식 설계 방식이 아닌 리팩터링을 통해 식별
- 코드 리팩터링 중에 복잡하거나 중복된 로직을 간단한 개념을 값 객체로 추출

#### 값 객체를 위한 가이드
여러 장소에서 `함께 사용되는 변수들`이 있다면 값 객체로 추출할 수 있을지 고민하라.