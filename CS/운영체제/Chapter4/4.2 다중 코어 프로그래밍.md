# 다중 코어 프로그래밍

각 코어는 운영체제에 별도의 CPU로 보인다. 이러한 시스템을 `다중 코어`라고 하며 다중 스레드 프로그래밍은 이러한 여러 컴퓨팅 코어를 보다 효율적으로 사용하고 병행성을 향상시키는 기법을 제공한다.

다중 코어에서 시스템이 각 코어에 별도의 스레드를 할당할 수 있기 때문에 일부 스레드가 병렬로 실행될 수 있음을 의미한다.

병행성과 병렬성의 차이

-   병행(논리적) 시스템은 모든 작업이 진행되게 하여 둘 이상의 작업을 지원한다.

-   병렬(물리적) 시스템은 둘 이상의 작업을 동시에 수행할 수 있다. 따라서 병렬성 없이 병행성을 가질 수 있다.

### ✅ 병행성(Concurrency) vs 병렬성(Parallelism)

#### 핵심 비교

| 항목        | 병행성 (Concurrency)                                             | 병렬성 (Parallelism)                                 |
| ----------- | ---------------------------------------------------------------- | ---------------------------------------------------- |
| 정의        | 여러 작업을 **번갈아가며** 빠르게 수행                           | 여러 작업을 **동시에** 수행                          |
| 목표        | 여러 작업을 동시에 진행하는 것처럼 **보이게** 함 (논리적 동시성) | 여러 작업을 실제로 동시에 **실행**함 (물리적 동시성) |
| CPU 코어 수 | 싱글 코어에서도 가능 (스케줄링으로 번갈아 처리)                  | 멀티 코어 필요 (진짜 동시에 실행)                    |
| 예시        | 싱글 스레드로 여러 네트워크 요청 번갈아 처리                     | 여러 CPU가 각각 다른 작업을 동시에 수행              |
| 비유        | 1명이 여러 테이블 서빙, 돌아가며 일 처리                         | 여러 사람이 각각 테이블에 전담 서빙                  |
| 대표 기술   | 스레드, 비동기 프로그래밍 (async/await)                          | 멀티스레딩, 멀티프로세싱                             |

과거에 단일 프로세서만 있었으며 CPU 스케줄러는 프로세스간을 빠르게 전환하여 각 프로세스는 병행하게 실행되었지만 병렬로 실행되지는 않았다.

## 4.2.1 프로그래밍 도전과제

일반적으로 다중 코어 시스템을 위해 프로그래밍 하기 위해서는 5개의 극복해야 할 도전과제가 있다.

-   `태스크 인식 : 응용을 분석하여 독깁된 병행 가능 태스크로 나눌 수 있는 영역을 찾는 작업이 필요하다.` 이상적으로는 태스크는 서로 독립적이고 따라서 개별 코어에서 병렬 실행될 수 있어야 한다.

-   `균형 : 찾아진 부분들이 전체 작업에 균등한 기여도를 가지도록 태스크를 나누는 것도 매우 중요하다.` 어떤 경우에는 다른 태스크에 비해 기여도가 적은 작업이 있을 수 있으며 이러한 작업을 실행하기 위해 별도의 코어를 사용하는 것은 그만한 가치가 없다.

-   데이터 분리 : 응용이 독립된 태스크로 나누어지는 것처럼, 태스크가 접근하고 조작하는 데이터 또한 개별 코어에서 사용할 수 있도록 나누어져야 한다.

-   데이터 종속성 : 태스크가 접근하는 데이터는 둘 이상의 태스크 사이에 종속성이 없는지 검토되어야 한다. 한 태스크가 다른 태스크로부터 오는 데이터에 종속적인 경우에는 프로그래머가 데이터 종속성을 수용할 수 있도록 태스크의 수행을 잘 동기화 해야 한다.

-   시험 및 디버깅 : 프로그램이 다중 코어에서 병렬로 실행될 때 다양한 실행 경로가 존재할 수 있다. 그런 병행 프로그램을 시험하고 디버깅하는 것은 단일 스레드 응용을 시험하고 디버깅하는 것보다 근본적으로 훨씬 어렵다.

## 4.2.2 병렬 실행의 유형

일반적으로 데이터 병렬 실행과 태스크 병렬 실행의 두 가지 유형이 존재한다.

-   데이터 병렬실행 : 동일한 데이터의 부분집합을 다수의 계산 코어에 분배한 뒤 각 코어에서 동일한 연산을 실행하는 데 초점을 맞춘다.

    -   크키가 N인 배열의 각 요소 더하기

-   태스크 병렬 실행 : 데이터가 아니라 태스크(스레드)를 다수의 코어에 분배한다. 각 스레드는 고유의 연산을 실행한다. 다른 스레드들이 동일한 데이터에 대해 연산을 실행할 수 있고 혹은 서로 다른 데이터에 연산을 실행할 수 있다.

기본적으로 데이터 병렬 처리에는 여러 코어에 데이터를 분배하는 것이 포함되고 태크스 병렬처리에는 여러 코어에 태스크를 분배하는 것이 포함된다.

데이터와 태스크병렬처리는 상호 배타적이지 않으며 실제로 응용프로그램은 이 두가지 전략을 혼합하여 사용할 수 있다.
