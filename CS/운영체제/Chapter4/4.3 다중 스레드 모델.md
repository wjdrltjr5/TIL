# 다중 스레드 모델

스레드를 위한 지원은 `사용자 스레드`를 위해서는 사용자 수준에서 `커널 스레드`를 위해서는 커널 수준에서 제공된다.

사용자 스레드는 커널 위에서 지원되며 커널의 지원 없이 관리된다. 반면 커널 스레드는 운영체제에 의해 직접 지원되고 관리된다.

현대의 운영체제들은 커널 스레드를 지원한다.

## 4.3.1 다대일모델

`다대일 모델은 많은 사용자 수준 스레드를 하나의 커널 스레드로 사상(mapping)한다.`

스레드 관리는 사용자 공간의 스레드 라이브러리에 의해 행해진다. 따라서 효율적이라 할 수 있다.

하지만 한 스레드가 봉쇄형 시스템 콜을 할 경우 전체 프로세스가 봉쇄된다. 또한 한번에 하나의 스레드만이 커널에 접근할 수 있기 때문에 다중스레드가 다중 코어시스템에서 병렬로 실행될 수 없다.

`그린 스레드`가 다대일 모델을 사용하였는데 Solaris 시스템을 위한 스레드 라이브러리를 말하며 Java의 초기버전에서도 채택되었다.

그러나 다중 처리 코어의 이점을 살릴 수 없기 때문에 현재는 거의 존재하지 않는다.

## 4.3.2 일대일 모델

각 사용자 스레드가 하나의 커널 스레드로 매핑된다. 이모델은 하나의 스레드가 봉쇄적 시스템콜을 호출해도 다른 스레드가 실행될 수 있기 때문에 다대일 모델보다 더 많은 병렬성을 제공한다.

이모델은 다중 처리기에서 다중 스레드가 병렬로 수행되는 것을 허용한다.

이 모델의 유일한 단점은 사용자 스레드를 만드려면 해당 커널 스레드를 만들어야 하며 많은 수의 커널 스레드가 시스템 성능에 부담을 줄 수 있다는 것 Linux는 Windows 운영체제 제품군과 함께 일대일 모델을 구현한다.

## 4.3.3 다대다 모델

다대다 모델은 여러 개의 사용자 수준 스레드를 그보다 작은 수, 혹은 같은 수의 커널 스레드로 멀티플렉스한다.

커널 스레드의 수는 응용프로그램이나 특정 기게에 따라 결정된다.

다대다 모델은 다대일, 일대일 모델의 단점들을 어느정도 해결했다 `개발자는 필요한 만큼 사용자 수준 스레드를 생성할 수 있다. 그리고 상응하는 커널 스레드가 다중 처리기에서 병렬로 수행될 수 있다.`

또한 스레드가 봉쇄형 시스템 콜을 발생시켰을 때 커널이 다른 스레드의 수행을 스케줄 할 수 있다.

다대다 모델의 변형은 여전히 많은 사용자 스레드를 적거나 같은 수의 커널 스레드로 멀티플렉스 시키지만 또한 한 사용자 스레드가 하나의 커널 스레드에만 연관되는 것을 허용한다.

이 변형은 때로 `두 수준 모델`이라고 불리며 다대다 모델이 논의된 모델 중 가장 융통성 있는 것으로 보이지만 실제로는 구현하기가 어렵다.

대부분의 시스템에서 처리 코어 수가 증가함에 따라 커널 스레드 수를 제한하는 것의 중요성이 줄어들었ㄷ. 결과적으로 대부분의 운영체제는 이제 일대일 모델을 사용한다.

울브 현대 병행 라이브러리는 개발자가 태스크를 식별하면 다대다 모델을 사용하여 스레드에 매칭될 수 있게 한다.
