# 대체 방안들

전통적으로 mutex락, 세마포와 모니터와 같은 깁버들이 이러한 쟁점을 해결하기 위하여 사용되어 왔다.

스레드-안전 병행 응용설계에 도움을 줄 수 있는 프로그래밍 언어와 하드웨어의 다양한 기능들

## 7.5.1 트랜잭션 메모리

`트랜잭션 메모리`의 개념은 데이터베이스 이론 분야에서 출발한 아이디어지만 프로세스 동기화 전략을 제공한다.

`메모리 트랜잭션`은 메모리 읽기와 쓰기 연산의 원자적인 연속적 순서이다.

한 트랜잭션의 모든 연산이 완수되면 메모리 트랜잭션은 확정된다. 그렇지 않으면 그 시점까지 완수된 모든 연산은 취소되고 트랜잭션 시작 이전 상태로 롤백한다.

전통적인 기법에 대한 대안으로 트랜잭션 메모리의 이점을 취할 수 있는 새로운 기능을 프로그래밍 언어에 추가할 수 있다.

락 대신 이러한 기법을 사용하는 이점은 개발자가 아니라 트랜잭션 메모리 시스템이 원자성을 보장할 책임이 있다는 것

또한 락이 전혀 사용되지 않기 때문에 교착 상태가 발생하는 것이 불가능하다.

게다가 트랜잭션 메모리 시스템은 원자적 블록 내에서 공유 변수에 대한 병행 읽기 연산과 같은 병행 실행될 수 있는 명령문들을 구별할 수 있다.

트랜잭션 메모리는 소프트웨어 또는 하드웨어로 구현될 수 있다. 이름이 나타내는것처럼 소프트웨어 트랜잭션 메모리(STM)는 특별한 하드웨어 없이 소프트웨어 만으로 구현된다.

STM은 트랜잭션 블록 안에 검사 코드를 삽입함으로써 동작한다. 이코드는 컴파일러에 의해 삽입되어 명령문들이 동시에 실행될 수 있는 지점과 저수준 락킹이 필요한 지점을 검사함으로써 각 트랜잭션을 관리한다.

하드웨어 트랜잭션 메모리 (HTM)는 개별 처리 캐시에 존재하는 공유 데이터의 충돌을 해결하고 관리하기 위하여 하드웨어 캐시 계층 구조와 캐시 일관성 프로토콜을 사용한다.

HTM은 코드 계측이 필요 없고 따라서 STM 보다 적은 오버헤드를 가진다. 그러나 기존의 캐시 계층 구조와 캐시 일관성 프로토콜을 트랜잭션 메모리를 지원하기 위하여 변경해야 한다.

## 7.5.2 OpenMP

OpenMP는 컴파일러 디렉티브와 API로 구성된다.

컴파일러 디렉티브 #pragma omp parallel 이후에 등장하는 코드는 병렬구역으로 인식되어 시스템의 처리 코어 개수만큼 스레드에 의해서 실행된다.

OpenMP(그리고 그와 유사한 도구들)가 가지는 장점은 스레드의 생성과 관리가 OpenMP 라이브러리에 의해서 처리되어 응용 개발자들은 신경 쓰지 않아도 된다는 것

#pragma omp parallel 컴파일러 디렉티브와 함께 OpenMP는 #pramga omp critical이라는 디렉티브를 제공한다.

이 디렉티브는 디렉티브 이후에 나오는 코드 구역을 임계구역으로 지정하여 한 번에 하나의 스레드만이 실행할 수 있게 한다.

이런식으로 OpenMP는 스레드가 경쟁 조건을 발생시키지 않는다는 것을 보장할 수 있도록 지원한다.

임계구역 컴파일러 디렉티브는 이진 세마포 혹은 mutex 락처럼 동작하여서 한순간에 오직 하나의 스레드만이 임계구역을 실행한다는 것을 보장하게 한다.

만일 어떤 스레드가 임계구역에서 실행 중일때 다른 스레드가 임계구역에 진입하려고 한다면 소유주 스레드가 임게구역을 빠져나갈깨 따기 호출 스레드는 봉쇄된다.

여러 임계구역기 사용되어야 한다면 각 임계구역은 별도의 이름을 할당받을 수 있으며 두 개 이상의 스레드가 동일한 이름을 가진 임게구역에서 동시에 활동할 수 없다는 규칙을 명시할 수 있다.

OpenMP에서 임계구역 컴파일러 디렉티브를 사용할 떄의 이점은 표준mutex 락보다 쉽게 사용할 수 있다고 생각된다는 것

그러나 응용 개발자가 가능한 경쟁 조건을 직접 발견해 내야만하고 컴파일러 디렉티브를 이용하여 공유 메모리를 직접 보호애햐 한다는 것이 단점

임계구역 컴파일러 디렉티브는 mutex 락처럼 동작하기 때문에 두 개 이상의 임계구역이 관여되었을 때 여전히 교착 상태가 발생할 수 있다.

## 7.5.3 함수형 프로그래밍 언어

C, C++, Java와 C#은 `명령형` 혹은 `절차형`언어라고 한다.

다중 코어 시스템에서 병행 및 병렬 프로그래밍이 주목받으면서 `함수형`프로그래밍 언어에 대한 관심도 커지고 있다. 함수형 프로그래밍 언어는 명령형 언어가 제공하는 패러다임과는 많이 다른 패러다임을 따른다.

근본적인 차이는 함수형 언어는 상태를 유지하지 않는다는것

변수가 정의되어 값을 배정받으면 그 값은 변경될 수 없기 때문에 변하지 않는다.

함수형 언어는 변경 가능 상태를 허용하지 않기 때문에 경쟁 조건이나 교착 상태와 같은 쟁점에 대해 신경 쓸 필요가 없다.
