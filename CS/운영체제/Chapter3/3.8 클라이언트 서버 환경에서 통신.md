# 클라이언트 서버 환경에서 통신

-   소켓(sockets)
-   원격프로시저 호출(RPCs)

## 3.8.1 소켓

`소켓`은 통신의 극점을 뜻한다. 두 프로세스가 네트워크상에서 통신을 하려면 양 프로세스마다 하나씩, 총 두개의 소켓이 필요해진다(한쌍)

각 소켓은 IP주소와 포트 번호 두 가지를 접합해서 구별한다. 일반적으로 소켓은 클라이언트-서버 구조를 사용한다.

서버는 지정된 포트에 클라이언트 요청 메시지가 도착하기를 기다리게 된다 요청이 수신되면 서버는 클라이언트 소켓으로부터 연결 요청을 수락함으로써 연결이 완성된다.

Telnet, ftp 및 http 등의 특정 서비스를 구현하는 서버는 well-known포트로부터 메시지를 기다린다.(well-known 이란 전 세계적으로 표준으로 사용하는 포트 번호라는 의미 ex, http : 80, ssh : 22)

클라이언트 프로세스가 연결을 요청하면 호스트 컴퓨터가 포트 번호를 부여한다. 이 번호는 1024 보다 큰 임의의 정수가 된다.

두 호스트 사이에 패킷들이 오갈 떄 그 패킷들은 이 목적지 포트 번호가 지정하는 데 따라 적절한 프로세스로 배달된다.

모든 연결은 유일해야 한다. 따라서 호스트 X에 있는 다른 클라이언트 프로세스가 동일한 웹 서버와 통신을 하면 그 클라이언트는 기존 소켓 포트와 다른 번호를 부여받게 된다.

Java 는 세 가지 종류의 소켓을 제공한다. `연결기반 (TCP)` 소켓은 Socket 클래스로 구현된다.

`비연결성 (UDP)` 소켓은 DatagramSocket 클래스를 사용한다. 마지막으로 MulticastSocket 클래스는 DatagramSocket 클래스의 서브클래스이다. Multicast 소켓은 데이터를 여러 수신자에게 보낼 수 있다.

accept()는 클라이언트와 통신하기 위해 사용할 수 있는 소켓을 반환한다.

-   서버는 포트 6013 listen 한다는 것을 지정하는 ServerSocket을 생성한다.
-   그후 accept() 메서드를 이용하여 listen하게 된다.
-   서버는 accept() 메서드에서 클라이언트가 연결을 요청할 때까지 봉쇄된다.
-   연결 요청이 들어오면 accept()는 클라이언트와 통신하기 위해 사용할 수 있는 소켓을 반환한다.

소켓을 이용한 통신은 분산된 프로세스간에 널리 사용되고 효율적이기는 하지만 너무 낮은 수준

소켓은 스레드 간에 구조화 되지 않은 바이트 스트림만을 통신하도록 하기 때문 이러한 원시적인 바이트 스트림 데이터를 구조화하여 해석하는 것은 클라리언트와 서버의 책임이 된다.

이에 대한 대안으로 더욱 수준높은 통신 기법인 원격 프로시저 호출(RPC)을 보자

## 3.8.2 원격 프로시저 호출 Remote Procedure Calls

원격서비스와 관련하여 가장 보편적인 패러다임 네트워크에 연결된 두 시스템 사이의 통신에 사용하기 위하여 프로시저 호출 기법을 추상화하는 방법으로 설계되었다.

IPC와 많은 측면에서 유사하며 사실 그러한 IPC기반 위에 만들어진다. `그러나 여기서는 프로세스들이 서로 다른 시스템 위에서 돌아가기 때문에 원격 서비스를 제공하기 위해서는 메시지 기반 통신을 해야 한다.`

IPC방식과는 달리 RPC 통신에서 전달되는 메시지는 구조화되어 있고, 따라서 데이터의 패킷 수준을 넘어서게 된다.

각 메시지에는 원격지 포트에서 listen중인 RPC 디먼의 주소가 지정되어있고 실행되어야 할 함수의 식별자, 그리고 그 함수에게 전달되어야 할 매개변수가 포함된다.

그런 후에 요청된 함수가 실행되고 어떤 출력이든지 별도의 메시지를 통해 요청자에게 반환된다.

이 문맥에서 `포트`는 단순시 메시지 패키지의 시작 부분에 포함되는 정수이다.

원격 프로세스가 어떤 서비스를 받고자 하면 그 서비스에 대응되는 적적한 포트 주소로 메시지를 보내야 한다.

RPC는 클라이언트가 원격 호스트의 프로시저 호출하는 것을 마치 자기의 프로시저 호출하는 것처럼 해준다. RPC 시스템은 클라이언트 쪽에 `스텁`을 제공하여 통신을 하는 데 필요한 자세한 사항들을 숨겨 준다.

그러면 스텁이 원격 서버의 포트를 찾고 매개변수를 정돈한다. 그 후 메시지 전달 기법을 사용하여 서버에게 메시지를 전송한다.

이에 대응하는 스텁이 서버에도 존재하여 서버 측 스텁이 메시지를 수신한 후 적절한 서버의 프로시저를 호출한다.

Windows 시스템 에서는 스텁 코드 Microsoft Interface Definition Language(MIDL)로 작성된 명세로부터 컴파일 된다.

이 언어는 클라이언트와 서버 프로그램 사이의 인터페이스를 정의하는데 사용된다.

해당 호출에 대한 응낙 메시지 (ack 메시지, acknowledgement)를 받을 때까지 클라이언트는 주기적으로 각 RPC 호출을 재전송 해야 한다.
