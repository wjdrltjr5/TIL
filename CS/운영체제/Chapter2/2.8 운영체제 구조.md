# 운영체제 구조

현대의 운영체제와 같이 크고 복잡한 시스템은 적절하게 동작하고 쉽게 변경될 수 있으려면 싲우히 제작되어야 한다. 일반적인 접근 방법은 한 개의 일관된 시스템 보다는 태스크를 작은 구성요소로 분할하는 것이다.(자신의 프로그램을 구성할 떄 메서드 단위로 기능을 분리하는 것처럼)

## 2.8.1 모놀리식 구조

가장 단순한 구조, 커널의 모든 기능을 단일 주소 공간에서 실행되는 단일 정적 이진파일에 넣는것

단순성에도 불구하고 구현 및 확장이 어렵지만 성능면에서 뚜렷한 이점이 있다.

시스템 콜 인터페이스에는 오버헤드가 거의 없고 커널 안에서의 통신 속도가 빠르다. 모놀리식 커널의 단점에도 불구하고, 속도와 효율성은 이 구조으이 증거를 여전히 UNIX, Linux 및 Windows운영체제에서 발견할 수 있는 이유

## 2.8.1 계층적 접근

모놀리식 접근법이 `밀접하게 결합된` 시스템이라 불린다. 그 대안으로 `느슨하게 결합된` 시스템을 설계할 수 있다.

시스템은 기능이 특정 기능 및 한정된 기능을 가진 개별적이며 작은 구성요소로 나뉜다. 이 모든 구성요소가 합쳐져 커널을 구성한다.

이 모듈방식의 장점은 한 구성요소의 변경이 해당 구성요소에만 영향을 미치고 다른 구성요소에는 영향을 미치지 않으므로 시스템 구현자가 시스템의 내부 작동을 더 자유롭게 생성하고 변경할 수 있다는 것

최하위 층은 하드웨어이고 최상위층은 사용자 인터페이스이다. 층들은 단지 자신의 하위층들의 서비스와 기능들만 사용하도록 선택된다.

이러한 접근 방법은 시스템의 검증과 디버깅 작업을 단순화한다. 만일 어느 층의 디버깅중 오류가 발견되면 그 하위의 층은 이미 디버깅되었기 떄문에 오류는 반드시 그 층에 있다.

그럼에도 순수한 계층 접근 방식을 사용하는 운영체제는 비교적 적다. 각 계층의 기능을 적절히 정의해야 하는 문제와 시스템의 전반적인 성능은 운영체제 서비스를 얻기 위해 사용자 프로그램이 여러 계층을 통과해야하는 오버헤드로 인해 열악하다.

그러나 어느 정도의 계층화는 현대 운영체제에서 공통적이다. 일반적으로 이러한 시스템은 더 많은 기능을 가진 더 적은 개수의 층을 가지므로 층 기능의 정의 및 상호작용의 문제를 피하면서 모듈화된 코드의 장점을 최대한 활용할 수 있다.

## 2.8.3 마이크로커널

UNIX가 확장함에 따라 커널이 커지고 관리하기 힘들어졌다 Carnegie-Mellon 대학교의 연구자들이 `마이크로커널`접근 방식을 사용하여 커널을 모듈화한 `Mach`라 불리는 운영체제를 개발하였다.

중요치 않은 요소들을 커널로부터 제거하고 별도의 주소 공간에 존재하는 사용자 수준 프로그램으로 구현하여 운영체제를 구성하는 방법

어느 서비스가 커널에 남아야하고 남지 말아야 하는지 의견이 일치하지 않는다. 그러나 통상 마이크로커널은 통신 설비 외에 추가로 최소한의 프로세스와 메모리 관리를 제공한다.

마이크로커널의 주 기능은 클라이언트 프로그램과 역시 사용자 공간에서 수행되는 다양한 서비스간에 통신을 제공하는 것

마이크로커널 접근법의 한 가지 장점은 운영체제의 확장이 쉽다는 것

마이크로커널은 가중된 시스템 기능 오버헤드 때문에 성능이 나빠진다. 두 개의 사용자 수준 서비스가 통신해야 하는 경우 별도의 주소공간에 서비스가 존재하기 때문에 메시지가 복사되어야 한다.

운영체제는 메시지를 교환하기 위해 한 프로세스에서 다음 프로세스로 전환해야 할 수도 있다. 메시지 복사 및 프로세스 전환과 관련된 오버페드는 마이크로 커널 운영체제의 성장에 가장 큰 장애였다.

## 2.8.4 모듈

운영체제를 설계하는데 이용되는 최근 기술 중 최선책은 `적재가능 커널 모듈 (LKM)`기법의 사용일 것이다.

커널은 핵심적인 구성요소의 집합을 가지고 있고 부팅 때 또는 실행 중에 부가적인 서비스들을 모듈을 통하여 링크할 수 있다. (Linux, Max OS X, Solaris 및 Window 등) 현대 UNIX를 구현하는 일반적인 추세

설계의 주안점은 커널은 핵심 서비스를 제공하고 다른 서비스들은 커널이 실행되는 동안 동적으로 구현하는 것

서비스를 동적으로 링크하는 것은 새로운 기능을 직접 커널에 추가하는 것보다 바람직하다. 커널의 직접 추가의 경우 수정 사항이 생길 때마다 커널을 다시 컴파일 해야 한다.

전체적인 결과는 커널의 각 부분이 정의되고 보호된 인터페이스를 가진다는 점에서 계층 구조를 닮았다. 그러나 모듈에서 임의의 다른 모듈을 호출할 수 있다는 점에서 계층구조보다 유연하다.

중심 모듈은 핵심 기능만 가지고있도 다른 모듈의 적재 방법과 모듈들과 어떻게 통신하는지 안다는 점에서 마이크로 커널과 유사핟. 그러나 통신하기 위하여 메시지 전달을 호출할 필요가 없디 때문에 효율적이다.

## 2.8.5 하이브리드 시스템

엄격하게 정의된 하나의 구조를 채택한 운영체제는 거의 존재하지 않는다. 대신 다양한 구조를 결합하여 성능, 보안 및 편리성 문제를 해결하려는 혼용 구조로 구성된다.

Linux의 경우 운영체제 전부가 하나의 주소 공간에 존재하여 효율적인 성능을 제공하기 때문에 모놀리식 구조이지만 모듈을 사용하기 떄문에 새로운 기능을 동적으로 커널에 추가할 수 있다.

사용자 모드 프로세스로 실행되는 분리된 서브시스템은 전형적인 마이크로커널의 형태를 유지하고 있다.
