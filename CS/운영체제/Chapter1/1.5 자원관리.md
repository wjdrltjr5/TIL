# 자원관리

운영체제는 `자원관리자`이다 시스템의 CPU, 메모리 공간, 파일-저장 공간 및 I/O 장치는 운영체제가 관리해야 하는 자원에 속한다.

## 1.5.1 프로세스 관리

프로그램은 CPU에 의해 명령이 실행되지 않으면 아무것도 할 수 없다.

프로세스는 자기 일을 수행하기 위핸 CPU 시간, 메모리, 파일, 그리고 입출력 장치를 포함한 여러 가지 자원을 필요로 한다.

프로그램 그 자체는 프로세스가 아님을 강조한다. 하나의 프로그램은 디스크에 저장된 파일의 내용과 같이 수동적 개체지만 프로세스는 다음 수행할 명령얼 지정하는 `프로그램 카운터`를 가진 능동적 개체이다.

프로세스의 수행은 반드시 순차적이라야 하며 CPU는 그 프로세스가 끝날 때까지 그 프로세스의 명령들을 차례대로 수행한다.

`다중 스레드 프로세스는 여러 개의 프로그램 카운터를 가지고 있으며 이 카운터들은 각 스레드가 실행할 다음 명령어를 가리키게 된다. `(JVM에도 PC레지스터는 각 스레드별로 있었지)

한 프로세스는 한 시스템 내의 작업의 단위이다. 시스템은 프로세스의 집합으로 구성되는데 프로세스 중 일부는 운영체제 프로세스들(시스템 코드를 수행하는 프로세스)이며 나머지는 사용자 프로세스(사용자 코드를 수행하는 프로세스)이다.

운영체제는 프로세스 관리와 연관해 다음과 같은 활동에 대한 책임을 진다.

-   사용자 프로세스와 시스템 프로세스의 생성과 제거
-   CPU에 프로세스와 스레드 스케줄하기
-   프로세스 일시 중지와 재수행
-   프로세스 동기화를 위한 기법 제공
-   프로세스 통신을 위한 기법 제공

## 1.5.2 메모리 관리

메인 메모리는 현대 컴퓨터 시스템의 작동에 중추적인 역할을 한다.

메모리는 크기가 수십 만에서 수십 억까지의 범위를 갖는 바이트의 대용량 배열이다. 각 바이트는 자신의 주소를 가진다.

메인 메모리는 CPU와 입출력 장치에 의하여 공유되는, 빠른 접근이 가능한 데이터의 저장소이다.

CPU가 디스크에서 가져온 데이터를 처리하려면, 이들 데이터는 CPU가 생성한 입출력 호출에 의해 먼저 메인 메모리로 전송되어야 한다.

(오라클에서 버퍼캐시에 적재한 후 작업 SGA 근데 Direct Path I/O PARALLEL, APPEND 힌트 사용하는 경우는 메인메모리에 적재하되 PGA영역에 적재 )

마찬가지로 CPU가 명령을 수행하기 위해서는 명령이 메인 메모리 내에 있어야 한다.

프로그램에 수행되기 위해서는 반드시 절대 주소로 매핑되고 메모리에 적재되어야 한다.

CPU이용률과 사용자에 대한 컴퓨터의 응답속도를 개선하기 위해 메모리에 여러개의 프로그램을 유지해야 하며, 이를 위해서 메모리 관리 기법이 필요하다.

운영체제는 메모리 관리와 관련하여 다음과 같은 일을 담당한다.

-   메모리의 어느 부분이 현재 사용되고 있으며 어느 프로세스에 의해 사용되고 있는지 추적 (사용추적)
-   필요에 따라 메모리 공간을 할당하고 회수해야 한다.
-   어떤 프로세스(또는 그 일부)들을 메모리에 적재하고 제거할 것인가를 결정해야 한다.

## 1.5.3 파일 시스템관리

운영체제는 파일을 물리적 매체로 매핑하며 저장장치를 통해 이들 파일에 접근한다.

파일은 파일 생성자에 의해 정의된 관련 정보의 집합체이다.

운영체제는 대량 저장 매체와 그것을 제어하는 장치를 관리함으로써 파일의 추상적인 개념을 구현한다. 파일은 사용하기 쉽도록 통상 디렉터리들로 구성된다.

다수의 사용자가 파일에 접근하려고 할 때는 누구에 의해서 그리고 어떤방법(R, W, 첨가)으로 파일이 접근되어야 하는가를 통제하는 것이 바람직하다.

운영체제는 파일 관리를 위하여 다음과 같은일을 담당한다.

-   파일의 생성 및 제거 (계층적으로 구분)
-   디렉터리 생성 및 제거
-   파일과 디렉터리를 조작하기 위한 프리미티브의 제공
-   파일을 보조저장장치로 매핑
-   안정적인(비휘발성) 저장 매체에 파일을 백업

## 1.5.4 대용량 저장장치 관리

컴퓨터 시스템은 메인 메모리를 백업하기 위해 보조저장장치를 제공해야 한다.

운영체제는 보조저장장치 관리와 관련하여 다음 활동을 담당한다.

-   마운팅과 언마운팅
-   사용 가능 공간(free-space)
-   저장장소 할당
-   디스크 스케줄링
-   저장장치 분할
-   보호

## 1.5.5 캐시 관리

`캐싱`은 컴퓨터 시스템의 중요한 원리이다. 정보가 사용됨에 따라 더 빠른 장치엔 캐시에 일시적으로 복사된다. 우리는 먼저 캐시에 그 정보가 있는지를 조사해 보아야 한다.

CPU내부의 프로그램 가능한 레지스터들은 메인 메모리를 위한 고속의 캐시로 볼 수 있다. 프로그래머(또는 컴파일러)는 어느 정보를 메인 메모리에 두고, 어느 정보를 레지스터에 둘것인지를 결정하는 레지스터 할당 정책과 교체 알고리즘을 구현한다.

하드웨어로 구현된 캐시도 있다. 시스템 대부분은 다음에 수행될 것으로 예상되는 명령을 넣어두는 명령 캐시를 갖고 있다. 만약 명령 캐시가 없다면, CPU는 메인 메모리로부터 다음 명령을 인출해 올 동안 몇 사이클을 기다려야 한다.

시스템 배부분은 하나 이상의 고속 데이터 캐시를 가지고 있다. 하드웨어로만 구성된 캐시는 운영체제로 제어할 수 없다.

캐시 크기가 제한되어 있으므로 `캐시 관리`는 중요한 설계 문제이다.

| 층  | 명칭            | 전형적인 크기 | 구현 기술                         | 접근 시간(ms)   | 대역폭(MB/sec)   | 관리자   | 백업 여부      |
| --- | --------------- | ------------- | --------------------------------- | --------------- | ---------------- | -------- | -------------- |
| 1   | 레지스터        | < 1 KB        | 다중포트를 가진 고유 메모리, CMOS | 0.25 - 0.5      | 20,000 - 100,000 | 컴파일러 | 캐시           |
| 2   | 캐시            | < 16 MB       | 온칩 또는 오프칩 CMOS RAM         | 0.5 - 25        | 5,000 - 10,000   | 하드웨어 | 메인 메모리    |
| 3   | 메인 메모리     | < 64 GB       | CMOS SRAM                         | 80 - 250        | 1,000 - 5,000    | 운영체제 | 디스크         |
| 4   | 반도체 디스크   | < 1 TB        | 플래시 메모리                     | 25,000 - 50,000 | 500              | 운영체제 | 디스크         |
| 5   | 디스크 저장장치 | < 10 TB       | 자기 디스크                       | 5,000,000       | 20 - 150         | 운영체제 | CD 또는 테이프 |

저장장치의 계층 구조에서 각 수준 간의 정보 이동은 하드웨어 설계나 제어하는 운영체제에 따라 명시적 또는 묵시적으로 이루어진다.

메모리의 계층 구조에서 동일한 데이터가 서로 다른 수준의 저장장치 시스템에 나타나게 된다

-   B라는 파일에 있는 A라는 변수가 1증가된다고 했을때
-   파일 B가 자기디스크에 있다고 가정
-   증가 연산은 A가 있는 디스크블록을 메인 메모리로 복사해오는 입출력 연산을 호출
-   A를 캐시에 복사 -> A를 다시 내부 레지스토 복사
-   A의 복사본이 여러곳에 존재
-   내부 레지스터에서 증가가 일어나면 A의 값은 여러 저장장치 시스템에서 서로 달라진다.
    -   자바에서 Volatile키워드가 존재하는 이유
-   A의 값은 자기 디스크에 새로운 A의 값이 다시 기록된 이후에나 같아진다.
-   여러 프로세스가 A에 접근하기를 원할 경우 갱신된 A의값을 얻을것을 보장하기 위해서는 극도의 주의가 필요

CPU가 내부 레지스터를 유지할 뿐만 아니라 로컬 캐시도 갖고 있는 다중 처리기 환경하에서는 상황이 더욱 복잡해 진다.

이러한 상황을 `캐시 일관성 문제`라고 하며 일반적으로 하드웨어적 문제이다.

## 1.5.6 입출력 시스템 관리

운영체제의 목적 중 하나는 사용자에게 특정 하드웨어 장치의 특성을 숨기는것

UNIX에서 입출력 장치의 특성은 `입출력 서브시스템`에 의해 운영체제 자체의 대부분으로부터 숨겨져있다.

입출력 시스템은 다음과 같이 구성되어 있다.

-   버퍼링, 캐싱, 스풀링을 포함한 메모리 관리 구성요소
-   일반적인 장치 드라이버 인터페이스
-   특정 하드웨어 장치들을 위한 드라이버

장치 드라이버만이 자신에게 지정된 특정 장치의 특성을 알고 있다.
