# 교착 상태로부터 회복

탐지 알고리즘이 교착 상태가 존재한다고 결정하면 여러 대안의 처리 방법이 있다

한 가지 방법은 교착 상태가 발생한 것을 운영자에게 통지해, 운영자가 수작업으로 처리하게 하는 것

다른 방법은 시스템이 자동으로 교착 상태로부터 `회복`하게 하는 것

교착 상태를 깨뜨리는 데는 두 가지 방법이 있다 한 가지 방법은 순환 대기를 깨뜨리기 위해 단순히 한 개 이상의 스레드를 중지 시키는 것

두 번째 방법은 교착 상태에 있는 하나 이상의 스레들로부터 자원을 선점하는 것

## 8.8.1 프로세스와 스레드 종료

프로세스 또는 스레드를 중지 시킴으로써 교착 상태를 제거하기 위해 우리는 두 방법의 하나를 사용한다. 두 방법 모두, 종료된 프로세스에게 할당되었던 모든 자원을 시스템이 회수한다.

-   교착 상태 프로세스를 모두 중지 : 이 방식은 확실하게 교착 상태의 사이클을 깨뜨리지만, 비용이 너무 크다 이들 프로세스가 오랫동안 연산 했을 가능성이 있으며, 이들 부분 계산의 결과들을 반드시 폐기해야 하며, 아마도 후에 다시 계산해야 하기 때문

-   교착 상태가 제거될 때까지 한 프로세스씩 중지 : 이 방법은 각 프로세스가 중지될때 마다 교착 상태 탐지 알고리즘을 호출해 프로세스들이 아직도 교착 상태에 있는지 확인해야 하므로 상당한 오버헤드를 유발한다.

프로세스를 중지시키기는 쉽지 않다 프로세스가 파일을 갱신하는 도중이었다면, 그 중간에 종료시킬경우 파일은 부정확한 상태가 된다.

비슷하게 프로세스가 mutex락을 점유한 상태로 공유 데이터를 갱신하는 중이라면 공유 데이터의 무결성 면에서는 아무런 보장도 할 수는 없지만 시스템은 락 상태를 사용 가능한 상태로 복구해야 한다.

만일 부분 종료 방식을 사용한다면, 교착 상태인 프로세스들의 집합 중에서 교착 상태를 깨뜨리기 위해 어느 프로세스를 중지해야 할지를 반드시 결정해야 한다.

프로세스들을 중지시켰을 때 유발되는 비용이 최소인 프로세스들을 중단시켜야 한다.

어느 프로세스를 결정할지는 많은 요인이 있다.

-   프로세스의 우선순위가 무엇인지
-   지금까지 프로세스가 수행된 시간과 지정된 일을 종료하는데 더 필요한 시간
-   프로세스가 사용한 자원 유형과 수 (자원 선점하기가 단순한지)
-   프로세스가 종료하기 위해 더 필요한 자원의 수
-   얼마나 많은 수의 프로세스가 종료되어야 하는지

## 8.8.2 자원 선점

자원 선점을 이용해 교착 상태를 제거하려면 교착 상태가 깨질 때까지 프로세스로부터 자원을 계속 선점해 다른 프로세스에 주어야 한다.

선점을 위해 다음 세 가지 사항을 고려해야 한다.

-   희생사 선택(selection of a victim) : 어느 자원과 어느 프로세스들이 선점될 것인가 프로세스 종료에서와 같이 비용을 최소화하기 위해 선점의 순서를 결정해야 한다.

    -   비용 요인으로는 교착 상태 프로세스가 점유하고 있는 자원의 수 그리고 교착 상태 프로세스가 지금까지 실행하는 데 소요한 시간과 같은 매개변수들이 포함될 수 있다.

-   후퇴 (rollback) : 프로세스로부터 자원을 선점하려면, 그 프로세스를 어떻게 해야 하는가? 이 프로세스를 계속 정상적으로 실행할 수 없다는 점 선점당하면 자원이 부족하기 때문

    -   이 프로세스를 안전한 상태로 후퇴시키고, 그 상태로부터 다시 시작해야 한다.
    -   일반적으로 안전상태가 어떤 것인지 결정하기 어렵기 때문에 가장 단순한 해결책은 완전히 후퇴시키는 것. (중지 후 재실행)
    -   프로세스를 교착 상태를 깨뜨릴 수 있을 정도만 후퇴시키는 것이 효과적이지만 프로세스에 상태에 대한 보다 많은 정보를 유지할 것을 필요로 한다.

-   기아 상태(starvation) : 기아 상태가 발생하지 않는 것을 어떻게 보장할 것인가? 자원들이 동일한 프로세스로부터 항상 선점되지 않는다는 것을 어떻게 보장하는가
    -   프로세스가 단지 한정된 시간 동안만 희생자로 선정된다는 것을 반드시 보장해야 한다.
    -   일반적인 해결방법은 비용 요소에 후퇴 횟수를 포함시키는 방법
