# 교착 상태 특성

## 8.3.1 필요 조건들

교착상태는 한 시스템에 다음 네 가지 조건이 동시에 성립될 때 발생할 수 있다.

-   `상호 배제` (mutual exclusion) : 최소한 하나의 자원이 비공유 모드로 점유되어야 한다.

    -   비공유 모드에서는 한 번에 한 스레드만이 그 자원을 사용할 수 있다. 다른 스레드가 그 자원을 요청하면 요청 스레드는 자원이 방출될 때까지 반드시 지연되어야 한다.

-   `점유하며 대기` (hold-and-wait) : 스레드는 최소한 하나의 자원을 점유한 채, 현재 다른 스레드에 의해 점유된 자원을 추가로 얻기 위해 반드시 대기해야 한다.

-   `비선점` (no preemption) : 자원들을 선점할 수 없어야 한다. 즉, 자원이 강제적으로 방출될 수 없고, 점유하고 있는 스레드가 태스크를 종료한 후 그 스레드에 의해 자발적으로만 방출될 수 있다.

-   `순환 대기` (circular wait) : 대기하고 있는 스레드의 집합은 서로가 원형을 이루면서 점유한 자원을 대기한다.

## 8.3.2 자원 할당 그래프

교착상태는 `시스템 자원 할당 그래프`라고 하는 방향 그래프로 더욱 정확하게 기술할 수 있다.

이 그래프는 정점 V의 집합과 간선 E의 집합으로 구성된다. 정점 V의 집합은 시스템 내의 모든 활성 스레드 집합인 T와 시스템 내의 모든 자원 유형의 집합인 R의 두가지 유형으로 구성된다.

스레드 Ti로부터 자원 유형 Rj로의 방향 간선은 Ti -> Rj로 표현하며 이것은 스레드가 자원유형의 인스턴스를 하나 요청하는 것으로 현재 이 자원을 기다리는 상태이다. `요청 간선`

자원 유형 Rj로부터 스레드 Ti로의 방향간선은 자원이 스레드에 할당된것을 의미한다. `할당 간선`

자원할당 그래프의 정의로부터 만일 그래프가 사이클을 포함하지 않으면 시스템내 어느 스레드도 교착상태가 아니라는 것을 보일 수 있다.

반면, 그래프가 사이클을 포함하면 교착 상태가 존재할 수 있다.

각 자원 유형이 정확하게 하나의 인스턴스만을 가지면, 하나의 사이클은 교착상태가 발샐하였음을 암시한다.

만일 사이클이 각각 하나의 인스턴스만 갖는 자원 유형의 집합만을 포함한다면, 교착 상태가 발생한 것이다. (꽉 막혀있음 어느 한 스레드도 풀릴 가능성 없음)

사이클에 포함된 각 스레드는 교착상태에 있다 이경우에 그래프 내의 한 사이클은 교착상태가 존재하기 위한 필요, 충분 조건이 된다.

만일 각 자원 유형이 여러 개의 인스턴스를 가지면, 사이클이 반드시 교착상태가 발생했음을 의미하지는 않는다. 이경우 교착 상태가 존제하는 데 필요 조건이며 충분조건이 되지는 않는다. (풀릴 수 있으니까 실타래 풀듯이)

`자원 할당 그래프에 사이클이 없다면, 시스템은 교착 상태가 아니다, 사이클이 있다면 시스템은 교착상태일 수도 있고 아닐 수도 있다.`
