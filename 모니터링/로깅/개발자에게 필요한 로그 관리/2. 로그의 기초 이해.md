# 로그의 기초 이해

## 어떤 것을 로그로 남겨야 할까?

### 로그

항해에서 필요한 항해기록인 로그북이라는 단어에서 유래

트러블 슈팅에 도움이 될 것 같은 정보를 로그로 남겨야 한다. + (법적으로 필요한 경우)

대부분 controller단에 찍으면 될듯?

[강의에서 사용할 예제 프로젝트 (단축 url)](https://github.com/lleellee0/shorten-url-for-logging)

진짜 꼭 필요한 로그들이 무엇인가는 경험적으로 알게 된다

#### 범용적인 웹 서비스의 로그들

-   요청/응답 로그 : 디버깅과 성능 개선
-   오류 및 예외로그 : 장애 대응
-   사용자 활동 로그 : 감사 및 사용분석
    -   일반적으로 법적으로 남겨야 하는 로그
-   시스템 상태 로그 : 운영 모니터링
    -   이건 애플리케이션 보다는 모니터링에서 확인
-   데이터베이스 쿼리 로그 : 성능 최적화
    -   이것도 애플리케이션 로그는 X 별도로 관리
-   보안 로그 : 침해 대응 및 방어
-   배치 작업 로그 : 백그라운드 프로세스 모니터링
-   디버깅 로그 : 문제 추적.
    -   로컬 개발환경에서

이 로그들은 상황에 따라 적절히 조합하여 서비스 운영 및 개선에 활용

## 예외와 로그

모든 예외는 런타임에 발생한다. (사람들이 흔히 하는 오해 Checked 예외는 컴파일에 발생한다. 이건 문법적인 오류)

-   Checked Exception : 예외처리를 강제하는 예외 (spring 에서 커밋됨 비즈니스 로직따져서)
-   UnChecked Exception : 예외에 대한 처리를 강제하지 않는 예외 (spring 에서 롤백 됨)

-   Throwable (checked)
    -   Error(Unchecked)
        -   OOM
        -   stack overflow
    -   Exception(checked)
        -   CheckedException
        -   RuntimeException(Unchecked)

spring 기준 controllerAdvice에 로그를 찍자. info레벨로 찍는게 좋을듯

## 로그 레벨

-   TRACE : 가장 세부적인 수준의 로그, 코드의 세부적인 실행 경로 추적시 사용
-   DEBUG : 디버깅 목적의 로그, 개발 중 코드의 상태나 흐름을 이해하기 위해 사용
-   INFO : 시스템의 정상적인 운영 상태를 나타내는 정보성 로그
    -   오류 상황은 아니면서도 비즈니스 로직 실행 결과 같은 것 중요한 이벤트나 상태 변화를 기록
-   WARN : 잠재적으로 문제가 될 수 있는 상황을 나타내지만, 시스템 운영에는 즉각적인 영향을 주지 않는 경우 사용
    -   여기서 부터는 그냥 개발자의 개입이 필요한 상황인가를 확인할듯
-   ERROR : 치명적이지 않지만, 중요한 문제가 발생했음을 나타냅니다. 복구가 필요하거나 실패한 작업을 추적해야 할 때 사용
-   FATAL : 시스템 운영을 계속할 수 없을 정도로 심각한 오류가 발생했을 때 사용
    -   개발자가 지정보단 시스템 자체적으로 찍히는 경우가 많음

레벨별 설정 가능 ex. TRACE, DEBUG로그는 3일만 보관 | WARN는 1분당 10회이상 발생시 알람 + 일단위 리포트 | ERROR, FATAl 1회라도 발생시 알람.

#### 로그의 구성

시간 | 로그 레벨 | PID | 스레드 이름 | 패키지 + 클래스

쿼리 로그 같은 경우는 info보단 debug나 trace

## 로그 고도화하기

컨트롤러단에서 사용하는 로그 (trace) 보일러 플레이트 코드를 그냥 필터로 추가하자 서비스단은 AOP

INFO레벨의 로그는 비즈니스적인 의미가 있는데 사용 TRACE로그같은 경우는 요청에 대한 정보 (경로, 메서드, 바디)등 디테일한 정보 짧은 생명 주기로 저장

동시성에 대한 문제가 발생할 것 같은 지점엔 DEBUG
