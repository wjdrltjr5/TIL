# 인기글 Consumer 설계

-   인기글

    -   일단위로 상위 10건 인기글 선정
    -   좋아요 수/댓글 수 / 조회수 기반 점수 계산
    -   최근 7일 인기글 내역 조회

-   매일 게시글 생성 트래픽은 수백~수천만 건 이상
-   모든 게시글의 점수를 게산하고 인기글을 찾는 작업

## 방법1 배치

-   배치처리

    -   오전 12시가 되자마자 전날 작성된 게시글을 모두 순회
    -   각 게시글에 대해서 좋아요 수, 조회 수, 댓글 수를 조회
    -   점수 계산후 상위 10건 선정

-   처리해야 할 게시글의 개수는 대규모 데이터
    -   1시간만에 처리하기에는 시간이 촉박
    -   빠른 처리를 위해 병렬 시스템을 구출할 수도 있다.
        -   설계와 구현 복잡도 증가
        -   병렬로 처리하기 위한 장비의 리소스도 고려
        -   인기글 선정에는 게시글, 좋아요, 댓글 데이터가 필요하기 때문에 각각 독립된 서비스가 가지고있음
        -   인기글 선정을위해 각 서비스에 많은 데이터질의가 필요 부하가 타서비스까지 폭발적 증가

## 방법2 스트림처리

-   스트림
    -   연속적인 데이터 흐름
    -   실시간으로 발생하는 로그, 주식거래등 연속적으로 들어오는 데이터
-   스트림 처리
    -   스트림을 처리하는것
    -   연속적으로 들어오는 실시간 데이터를 처리하는 방식
-   인기글 선정을 위해 스트림 처리 애플리케이션을 구축
    -   게시글 생성/수정/삭제 이벤트
    -   댓글 생성/삭제 이벤트
    -   좋아요 생성/삭제 이벤트
    -   조회수 집계 이벤트

1. 인기글 선정에 필요한 이벤트를 스트림으로 받는다.
2. 실시간으로 각 게시글의 점수를 계산한다.
3. 실시간으로 상위 10건의 인기글 목록을 만든다.
4. Client는 인기글 목록을 조회한다.

# API vs Message Broker

## API

-   게시글/좋아요/조회수/댓글 서비스의 데이터 변경이 생기면
    -   인기글 서비스로 API를 이용한 이벤트 전송
-   간단한 구현
-   타 서비스에 직접적 의존, 시스템간 결합도 증가
-   서버 부하 전파
    -   인기글
        -   데이터를 실시간을 push받는다.
    -   게시글/좋아요/조회수/댓글
        -   데이터를 실시간으로 push한다.
    -   장애 전파, 유실 등의 위험 높음

## Message Broker

-   게시글/좋아요/조회수/댓글 서비스의 데이터 변경이 생기면
    -   메시지 브로커로 이벤트 전송하고, 인기글 서비스에서 이벤트를 가져와서 처리
-   복잡한 구현
    -   대규모 데이터를 안전하게 처리하기 위한 시스템 필요할 수도 있음
-   타 서비스에 메시지 브로커 이용한 간접적 의존성, 시스템 간 결합도 감소
-   서버 부하 전파

    -   인기글
        -   인기글 서비스는 메시지 브로커에서,
        -   적절하게 이벤트를 가져와서 비동기 처리 가능
    -   게시글/좋아요/조회수/댓글
        -   메시지 브로커로 이벤트 전송만 하면 된다.
    -   장애 전파, 유실 등의 위험 낮음

-   Kafka, RabbitMQ
