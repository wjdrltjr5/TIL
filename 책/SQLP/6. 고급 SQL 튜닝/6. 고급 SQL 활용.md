# 고급 SQL 활용

## 63 With 구문
With 절을 처리하는 DBMS 내부 실행 방식에는 아래 2가지가 있다.

- Materialize 방식 : 내부적으로 임시 테이블을 생성함으로써 반복 재사용
- Inline 방식 : 물리적으로 임시 테이블을 생성하지 않고 참조된 횟수만큼 런타임 시 반복 수행. SQL 문에서 반복적으로 참조되는 집합을 미리 선언함으로써 코딩을 단순화하는 용도(인라인 뷰와는, 메인 쿼리에서 여러번 참조가 가능하다는 점에서 다름)

오라클은 위 두가지 방식 모두 지원하지만, SQL Server 는 Inline 방식만 지원한다. 오라클의 경우 실행방식을 상황에 따라 옵티마이저가 결정하며, 필요하다면 사용자가 힌트로 선택할 수 있다.

Materialize 방식으로 실행하면서 생성한 임시 데이터는 영구적인 오브젝트가 아니며, With 절에서 선언한 SQL 문이 실행되는 동안만 유지된다. With절을 2개 이상 선언할 수 있으며, With절 내에서 다른 With절을 참조할 수도 있다.

배치 프로그램에서 특정 데이터 집합을 반복 재사용하거나, 전체 처리 흐름을 단순화시킬 목적으로 임시 테이블을 자주 활용하곤 하는데, 그럴 때 Materialize 방식의 With 절을 이용하면 명시적으로 오브젝트를 생성하지 않고도 같은 처리를 할 수 있다.


