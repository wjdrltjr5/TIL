# 대용량 배치 프로그램 튜닝

## 31 P -> P (PARALLEL_TO_PARALLEL) 오퍼레이션
데이터를 재분배하는 오퍼레이션이다. 실행계획에 P -> P 오퍼레이션이 나타나는 구간은 두 개의 서버 집합이 처리한다.

따라서 사용자가 지정한 병렬도의 2배수만큼 병렬 프로세스가 필요하다. 데이터 재분배 과정에 테이블 큐를 사용한다. 

데이터를 정렬 또는 그룹핑 하거나 조인을 위해 동적으로 파티셔닝할때 사용되며, 첫 번째 병렬 서버 집합이 읽거나 가공한 데이터를 두 번째 병렬 서버 집합에 전송하는 과정에서 병렬 프로세스간 통신이 발생하므로 Inter-Operation Parallelism 에 속한다.

## 32 IN-OUT 오퍼레이션
- PARALLEL_FROM_SERIAL(S -> P) : QC가 읽은 데이터를 테이블 큐를 통해 병렬 서버 프로세스에게 전송

- PARALLEL_TO_SERIAL(P -> S) : 각 병렬 서버 프로세스가 처리한 데이터를 QC에게 전송

- PARALLEL_TO_PARALLEL(P -> P) : 한 서버 집합이 반대편 서버 집합에 데이터를 전송

- PARALLEL_COMBINED_WITH_PARENT(PCWP) : 한 병렬 프로세스가 현재 스텝과 부모 스텝을 모두 처리

- PARALLEL_COMBINED_WITH_CHILD(PCWC) : 한 병렬 프로세스가 현재 스텝과 자식 스텝을 모두 처리

## 34 Granule
데이터를 병렬로 처리할 때 일의 최소 단위를 Granule 이라고 하며 병렬 서버는 한 번에 하나의 Granule씩만 처리한다.

### 블록 기반 Granule(= 블록 범위 Granule)
QC가 테이블로부터 읽어야 할 일정 범위의 블록을 각 병렬 프로세스에게 할당한다. 병렬 프로세스가 한 Granule에 대한 일을 끝마치면 이어서 다른 Granule를 할당한다.

따라서 프로세스간 처리량의 편차가 거의 발생하지 않는다 파티션 여부, 파팋션 개수와 무관하게 병렬도를 지정할 수 있다.

### 파티션 기반 Granule(= 파티션 Granule)
한 파티션에 대한 작업을 한 프로세스가 모두 처리하며, 아래와 같은 작업을 수행할 때 사용된다.

- Partition-Wise 조인 시
- 파티션 인덱스를 병렬로 스캔할 때 (Index Range Scan, Index Full Scan)
- 파티션 인덱스를 병렬로 갱신할 때
- 파티션 테이블 또는 파티션 인덱스를 병렬로 생성할 때

한 파티션을 두 개 프로세스가 함께 처리할 수 없으므로 병렬도를 파티션 개수보다 크게 지정하면 서버 리소스를 낭비하게 된다.

병렬도를 파티션 개수 이하로 지정할 때는 블록기반 Granule과 마찬가지로 먼저 일을 마친 프로세스에게 다음 파티션을 할당하낟.

더 처리할 파티션이 없을 때 먼저 일을 끝마친 프로세스는 다른 프로세스가 일을 마칠때까지 기다리게 되므로 파티션간 데이터양에 편차가 심할 때 리소스를 낭비하게 된다.
