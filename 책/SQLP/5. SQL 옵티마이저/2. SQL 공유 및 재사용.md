# SQL 공유 및 재사용

## 18 SQL 최적화 과정

옵티마이저가 SQL을 최적화할 떄도 데이터베이스 사용자들이 보통 생각하는 것보다 훨씬 많은 일을 수행한다.

SQL 최적화하는 동안 옵티마이전느 엄청나게 많은 연산을 수행하며, 그 과정에 사용하는 정보는 다음과 같다.

-   테이블, 컬럼 , 인덱스 구성에 관한 기본 정보
-   오브젝트 통계 : 테이블 통계, 인덱스 통계, 컬럼 통계
-   시스템 통계 : CPU 속도, Single Block I/O 속도, Multi Block I/O 속도 등
-   옵티마이저 관련 파라미터

하나의 쿼리를 수행하는 데 있어 후보군이 될만한 무수히 많은 실행 경로를 도출하고, 딕녀너리와 통계정보를 읽어 각각에 대한 효율성을 판단해야 하므로 하드 파싱 과정에 많은 CPU 자원을 사용한다.

SQL 최적화 과정이 하드한 이유다.

## 19 공유 가능 SQL

사용자 정의 함수/ 프로시저, 트리거, 패키지 등은 생성할 떄부터 이름을 갖는다.

컴파일한 상태로 딕셔너리에 저장되며, 사용자가 삭제하지 않는 한 영구적으로 보관된다. 실행할 때 라이브러리 캐시에 적재함으로써 여러 사용자가 공유하면서 재사용한다.

반면 SQL은 이름이 따로 없다. 전체 SQL 텍스트가 이름 역할을 한다 딕셔너리에 저장하지도 않는다.

처음 실행할 때 최적화 과정을 거쳐 동적으로 생성한 내부 프로시저를 라이브러리 캐시에 적재함으로써 여러 사용자 가 공유하면서 재사용한다.

캐시 공간이 부족하면 버려졌다가 다시 실행할떄 똑같은 최적화 과정을 거쳐 캐시에 적재된다. 의미적으로 100% 같은 SQL이더라도 텍스트 중 일부가 다르면 각각 최적화를 진행하고 라이브러리 캐시에서 별도 공간을 사용한다.

## 24 Static SQL vs Dynamic SQL

Static SQL 이란, String 형 변수에 담지 않고 코드 사이에 직접 기술한 SQL 문을 말한다. Embedded SQL 이라고도 한다.

Dynamic SQL이란 String 형 변수에 담아서 기술하는 SQL문을 말한다.

String 변수를 사용하므로 조건에 따라 SQL문을 동적으로 바꿀 수 있고, 또는 런타임 시에 사용자로부터 SQL문의 일부 또는 전부를 입력 받아서 실행할 수도 있다.

Static SQL을 지원하는 개발 언어로는 PowerBuilder,PL/SQL, Pro\*C, SQLJ 정도가 있다.

나머지 개발 언어에서 수행하는 SQL은 모두 Dynamic SQLdlek.

Static, Dynamic SQL은 애플리케이션 개발 측면에서의 구분일 뿐이며, DBMS 입장에서는 차이가 없다.

Static SQL을 사용하든 Dynamic SQL을 사용하든 DBMS 입장에서는 전달받은 SQL문 그 자체만 인식할 뿐이다.
