# 조인제거

1:M 관계인 두 테이블을 조인하는 쿼리문에서 조인문을 제외한 어디에서도 1쪽 테이블을 참조하지 않는다면

쿼리 수행시 1쪽 테이블은 읽지 않아도 된다. 결과집합에 영향을 미치지 않기 때문

옵티마이저는 이를 이용해 M쪽테이블만 읽도록 쿼리를 변환하는데 이를 조인제거 또는 테이블 제거라고 한다.

```sql
select e.empno, e.ename, e.deptno, e.sql, e.hiredate
from dept d, emp e
where d.deptno = e.deptno

Rows     Ros Source Operation
------  -----------------------
  14     TABLE ACCESS FULL EMP
```

위 쿼리에서 조인 조건식을 제외하면 1쪽 집합인 dept에 대한 참조가 전혀 없다 따라서 emp테이블만 액세스한 것을 볼 수 있다.

이 기능을 제어하는 파라미터는 아래와 같도 eliminate_join, no_eliminate_join 힌트를 통해 쿼리 리벨에서 제어할 수도 있다.

```sql
alter session set "_optimizer_join_elimination_enabled" = true;
```

조인 제거 기능이 작동하려면 아래와 같이 PK와 FK제약이 설정돼 있어야 한다.

옵티마이저가 쿼리 변환을 수행하기 위한 지극히 당연한 조치 만약 PK가 없으면 두 테이블간 조인 카디널리티를 파악할 수 없고 FK가 없으면 조인에 실패하는 레코드가 존재할 수도 있어 옵티마이저가 함부로 쿼리 변환을 수행할 수가 없다.

FK가 설정돼 있더라도 emp의 deptno 컬럼이 Null허용 컬럼이면 결과가 틀리게 될 수 있다.

조인 컬럼 값이 Null인 레코드는 조인에 실패해야 정상인데, 옵티마이저가 조인문을 함부로 제거하면 그 레코드들이 결과집합에 포함되기 때문이다.

그런 오류를 방지하기 위해 옵티마이저가 내부적으로 e.deptno is not null 조건을 추가해 준다.

Outer 조인할 때도 조인 제거가 가능한다.
