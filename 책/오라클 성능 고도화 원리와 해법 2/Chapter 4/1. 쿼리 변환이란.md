# 쿼리 변환이란?

간단한 SQL문 하나를 가지도고 52개의 다른 SQL문으로 표현이 가능하다.

결과가 동일하더라도 SQL문을 어떤 형태로 작성하느냐에 따라 성능에 차이가 생길 수 있다.

아래 두 쿼리도 결과는 같지만 수행 속도는 다를 수 있다. (쿼리변환 작동 안할시)

```sql
--1
select *
  from dept d
 where not exists (select 'x'
                     from emp
                    where deptno = d.deptno);
--2
select d.*
  from dept d, emp e
 where e.dpetno(+) = d.deptno
   and e.rowid is null;
```

애초에 가장 좋은 성능을 낼 수 있는 형태로 쿼리를 작성하면 좋겠지만 쿼리 최적화 원리를 그만큼 잘 아는 개발자는 흔치 않다.

그래서 최근의 비용기반 옵티마이저는 사용자 SQL을 최적화에 유리한 형태로 재작성하는 작업을 먼저 한다.

비용기반 옵티마이저의 서브 엔진으로서 Query Transformer, Estimator, Plan Generator가 있는데

그중 Query Transformer가 그역할을 담당한다.

쿼리 변환의 종류로는 아래와 같은 것들이 있다.

-   서브쿼리 Unnesting
-   뷰 Mergeing
-   조건절 Pushing
-   조건절 이행
-   공통 표현식 제거
-   Outer조인을 inner조인으로 변환
-   실체화 뷰 쿼리로 재작성
-   Star변환
-   Outer 조인 뷰에 대한 조인 조건 Pushdown
-   OR-expansion

쿼리 변환은 크게 다음 두가지 방식으로 작동한다.

-   휴리스틱 (Heuristic) 쿼리 변환 : 결과만 보장된다면 무조건 쿼리 변환을 수행한다 일종의 규칙기반

-   비용기반(Cost-based) 쿼리 변환 : 변환된 쿼리의 비용이 더 낮을 때만 그것을 사용하고, 그렇지 않을 때는 원본 쿼리 그대로 두고 최적화를 수행한다.

필요한 부분에 대해선 비용기반으로 모두 개선되었다.
