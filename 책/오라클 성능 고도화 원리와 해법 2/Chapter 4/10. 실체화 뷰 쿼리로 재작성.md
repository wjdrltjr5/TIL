# 실제화 뷰 쿼리로 재작성

일반적인 뷰는 하나 또는 그 이상의 테이블에 기초해 논리적으로 정의한 테이블로서 저장된 쿼리 또는 가상의 테이블이라고 불린다.

테이블이 사용될 수 있는 대부분 위치에 뷰를 사용할 수 있고, 뷰에 기초해 또 다른 뷰를 생성할 수도 있다.

정의에서도 알 수 있듯이 뷰는 쿼리만 저장하고 있을뿐 자체적으로 데이터를 갖지는 않는다.

반면 실체화 뷰는 materialize가 의미하는 것처럼 물리적으로 실제 데이터를 갖는다.

MV는 과거에 분산 환경에서 실시간 또는 일정 주기로 데이터를 복제하는 데 사용하던 Snapshot기술을 DW분야에 적응시킨 것이며, 여전히 데이터 복제 용도로 사용할 수 있다.

DW분야에서는 주로 두 개 이상의 테이블을 미리 조인해 두거나 대량의 테이블을 미리 group by 해서 집계해 두는 형태로 많이 활용되고 있다.

MV를 활용하는 이유는 기준 테이블이 그만큼 대용량이기 때문인데 join view는 같은 데이터를 중복 저장하는 비효율이 있어 활용도가 낮고 주로 Aggregate View 형태로 활용되는 편이다.

아래는 MV를 사용하게 만드는 가장 중요한 두 가지 특징이다.

-   Refresh 옵션을 이용해 오라클이 집계 테이블을 자동 관리하도록 할 수 있다.
-   옵티마지어에 의한 Query Rewrite가 지원된다.

사용자가 직접 관리하는 일반 집계테이블과 비교할때 MV의 가장 큰 장점은 자동으로 쿼리가 재작성 된다는 점이다.

일반 집계 테이블은 쿼리 작성자가 그런 집계 테이블이 있음을 미리 인자한 상태에서 직접 그 테이블을 참조하도록 쿼리를 작성해야만 한다.

하지만 MV는 사용자가 집계 테이블의 존재를 몰라도 된다. 사용자는 기준 테이블을 쿼리하지만 옵티마이저가 알아서 MV를 액세스 하도록 쿼리를 변환해 주기 떄문이다.

쿼리 재작성 기능이 작동하려면 MV를 정의할 때 enable query rewrite 옵션을 지정해 주어야 하고, 세션 또는 시스템 레벨에서 아래와 같이 파라미터도 변경해 주어야 한다.
