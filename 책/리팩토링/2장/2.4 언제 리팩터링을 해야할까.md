# 언제 리팩터링을 해야 할까?

```
3의 법칙
1. 처음에는 그냥 한다.
2. 비슷한 일을 두 번째로 하게 되면(중복이 생겼다는 사실), 일단 계속 진행한다.
3. 비슷한 일을 세 번째 하게 되면 리팩터링한다.
```

`스트라이크 세 번이면 리팩터링하라`

### 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기

리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전이다. 이 시점에 코드를 살펴보면서 구조를 살짝 바꾸면 다른 작업을 하기가 훨씬 쉬워질 만한 부분을 찾는다.

준비를 위한 리팩터링 -> 중복코드를 제거 (함수 매개변수화하기)

### 이해를 위한 리팩토링: 코드를 이해하기 쉽게 만들기

코드를 수정하려면 먼저 그 코드가 하는 일을 파악해야 한다. 코드를 파악할 떄마다

-   코드의 의도가 더 명확하게 드러나도록 리팩터링할 여지는 없는지 찾아본다.
-   조건부 로직의 구조가 이상하지 않은지 살펴본다.
-   함수이름이 적절한지 살펴본다.
-   수정한 코드를 테스트

코드를 분석할때 리팩터링을 해보면 깊은 수준까지 이해하게 된다.

### 쓰레기 줍기 리팩터링

코드를 파악하던 중이 비효율적으로 처리하는 모습을 발견할 떄가 있다.

-   로직이 쓸데없이 복잡하거나
-   매개변수화한 함수 하나면 될 일을 거의 똑같은 함수 여러 개로 작성해놨을 수 있다.

간단히 수정할 수 있는 것은 즉시 고치고, 시간이 좀 걸리는 일은 짧은 메모만 남긴 다음, 하던 일을 끝내고 나서 처리한다.

리팩터링의 멋진 점은 각각의 작은 단계가 코드를 깨뜨리치 않는다는 사실이다. 그래서 잡업을 잘게 나누면 몇 달에 걸쳐 진행하더라도 그 사이 한 순간도 코드가 깨지지 않기도 한다.

### 계획된 리팩터링과 수시로 하는 리팩터링

위 리팩터링은 모둬 기회가 될때만 진행한다.
`보기 싫은 코드를 발견하면 리팩터링하자. 그런데 잘 작성된 코드 역시 수많은 리팩터링을 거쳐야 한다.`

`무언가 수정하려 할 때는 먼저 수정하기 쉽게 정돈하고 그런 다음 쉽게 수정하자.`

소프트웨어 개발이란 뭔가 추가하는 과정으로 여겼다 뛰어난 개발자는 새 기능을 추가하기 쉽도록 코드를 수정하는 것이 그 기능을 가장 빠르게 추가하는 길일 수 있음을 안다.

버건 관리 시스템에서 리팩터링 커밋과 기능 추가 커밋을 분리해야 한다는 말이 있지만 굳이 나누는 것은 시간 낭비일 수 있다.

### 오래 걸리는 리팩터링

주어진 문제를 몇 주에 걸쳐 조금씩 해결해가는 편이 효과적일 때가 많다. 누구든지 리팩터링해야할 코드와 관련한 작업을 하게 될 때마다. 원하는 방향으로 조금씩 개선하는 식`리팩터링이 코드를 깨트리지 않는다는 장점을 활용하는 것이다.`

ex. 라이브러리 교체시 기존 것과 새것 모두를 포용하는 추상 인터페이스부터 마련

### 코드 리뷰에 리팩터링 활용하기

코드 리뷰는 개발팀 전체에 지식을 전파하는 데 좋다. 리팩터링은 다른 이의 코드를 리뷰하는 데도 도움된다.

리팩터링은 코드 리뷰의 결과를 더 구체적으로 도출하는 데에도 도움된다. 개선안들을 제시하는 데서 그치지 않고 그중, 상당수를 즉시 구현해볼 수 있기 때문이다.

### 관리자에게는 뭐라고 말해야 할까?

기술을 잘 모르는 관리자라면? 리팩터링 한다고 말하지 말라.

### 리팩터링 하지 말아야 할때

-   지저분한 코드를 발견해도 굳이 수정할 필요가 없다면 리팩터링 하지 않는다. 외부 API다루듯 호출해서 쓰는 코드라면 지저분해도 그냥 둔다.

-   리팩터링하는 것보다 처음부터 새로 작성하는 게 쉬울 때도 리팩터링 하지 않는다. 이결정은 뛰어난 판단력과 경험이 뒷받침돼야 한다.
