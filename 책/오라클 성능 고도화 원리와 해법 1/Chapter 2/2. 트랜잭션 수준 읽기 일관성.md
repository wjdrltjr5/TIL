# 트랜잭션 수준 읽기 일관성

## 트랜잭션 수준 읽기 일관성이란?

문장 수준 읽기 일관성(Statement-Level Read Consistency)은 쿼리가 시작된 시점을 기준으로 데이터를 일관성있게 읽어 들이는 것을 말한다.

트랜잭션 수준 읽기 일관성이란(Transaction-Level Read Consistency)은 트랜잭션이 시작된 시점을 기준으로 일관성있게 데이터를 읽어 들이는 것을 말한다.

오라클은 완벽한 문장수준의 읽기 일관성을 보장하지만, 트랜잭션에 대해서는 기본적으로 보장하지 않는다.

다른 DBMS도 마찬가지 트랜잭션 수준 읽기 일관성을 강화하려면 트랜잭션 고립화 수준을 높여 주어야 한다.

## 트랜잭션 고립화 수준

-   Read Uncommitted

    -   커밋되지 않은 데이터를 다른 트랜잭션에서 읽는 것 허용

    -   Dirty Read Non-Repeatable Read, Phantom Read 발생

    -   Oracle은 이 레벨을 지원하지 않음

-   Read Committed

    -   Dirty Read 방지 : 커밋되어 확정된 데이터만 읽는 것을 허용

    -   대부분의 DBMS의 기본모드

    -   Non-Repeatable Read, Phantom Read 현상은 여전히 발생

    -   Oracle을 Lock을 사용하지 않고 쿼리 시작지점의 Undo 데이터를 제공하는 방식으로 구현

-   Repeatable Read

    -   선행 트랜잭션이 읽은 데이터는 트랜잭션이 종료될 때까지 `후행 트랜잭션이 갱신하거나 삭제하는 것을 불허함`으로 써 같은 데이터는 두 번 쿼리했을 때 일관성 있는 결과를 리턴

    -   Phantom Read 현상은 발생한다.

    -   오라클은 이 레벨을 명시적으로 지원하지는 않지만 for update절을 이용해 구현 가능

-   Serializable
    -   선행 트랜잭션이 읽은 데이터를 후행 트랜잭션이 삽입, 수정, 삭제 불허
    -   완벽한 읽기 읽관성 제공

## Dirty Read

아직 커밋되지 않은 수정 중인 데이터를 다른 트랜잭션에서 읽을 수 있도록 허용할때 발생한다.

오라클은 자우 버전 읽기 일관성 모델을 채택함으로써 Lock을 사용하지 않고도 읽기가 가능하다.

따라서 레벨 0 수준으로 고립화 수준을 낮는 방법을 제공하지 않는다.

## Non-Repeatable Read

한 트랜잭션 내에서 같은 쿼리를 두번 수정할때 그사이 다른 트랜잭션이 값을 수정 또는 삭제하여 쿼리의 결과가 상이하게 나타나는 비 일관성

## Phantom Read

한 트랜잭션 안에서 일정범위의 레코드들을 두 번 이상 읽을 때, 첫번 째 쿼리에서 없던 유령레코드가 두 번째 쿼리에서 나타나는 현상

트랜잭션 도중 다른 트랜잭션에서 레코드 삽입을 허용하기 때문에 발생하는 현상

## 결론

트랜잭션 고립화 수준을 높이면 일관성은 향상되지만 동시성은 떨어진다.

오라클은 트랜잭션 고립화 수준읖 높이더라도 Lock을 사용하지 않으므로 동시성이 저하되지는 않는다.

오라클은 Lock을 사용하지 않은 상태에서 SCN확인 과정을 거침
