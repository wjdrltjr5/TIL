# 블록 단위 I/O

오라클을 포함한 모든 DBMS에서 I/O는 블록 단위로 이루어진다.

블록 단위로 I/O한다는 것은, 하나의 레코드에서 하나의 컬럼만을 읽으려 할 때도 레코드가 속한 블록 전체를 읽게 됨을 뜻한다.

블록 단위 I/O 원리 때문에 아래 두쿼리를 처리할때 서버에서 발생하는 I/O측면에서 일량은 같다(하지만 네트워크를 통해 클라이언트에전송되는 일량에는 차이가 난다!)

```sql
select ename from emp where sal >= 2000;

select * from emp where sal >= 2000;
```

SQL성능을 좌우하는 가장 중요한 성능지표는 액세스하는 블록 개수이며, 옵티마이저의 판단에 가장 큰 영향을 미치는 것도 액세스해야 할 블록 개수이다.

옵티아미저가 인덱스를 이용해 테이블을 액세스할지 아니면 Full Table Scan할지를 결정하는 데 있어 가장 중요한 판단 기준은 읽어야할 레코드 수가 아니라 읽어야 하는 블록 개수다.

블록 단위 I/O는 버퍼 캐시와 데이터 파일 I/O 모두에 적용된다.

-   메모리 버퍼 캐시에서 블록을 읽고 쓸때
-   데이터파일에 저장된 데이터 블록을 직접 읽거나 쓸때(Direct Path I/O)
-   데이터파일에서 DB 버퍼 캐시로 블록을 적재할 때 : Single Block Read 또는 Multiblock Read 방식을 사용
-   버퍼캐시에서 변경된 블록을 다시 데이터파일에 저장할 때 : Dirty 버퍼를 주기적으로 데이터파일에 기록하는 것을 말하며

오라클 딕셔너리 정보를 저장하는 딕셔너리 캐시는 로우 단위로 I/O를 수행한다 딕셔너리 캐시를 로우 캐시라고도 부르는 이유

## Sequential vs Random 액세스

Sequential 액세스 : 레코드간 논리적 또는 물리적 순서를 따라 차례대로 읽어 나가는 방식을 말한다.

Sequential 액세스 성능을 향상시키려고 오라클 내부적으로 Multiblock I/O, 인덱스 Prefetch같은 기능을 사용한다.

Random 액세스는 레코드간 논리적, 물리적 순서를 따르지 않고 한 건을 읽기 위해 한 블록씩 접근하는 방식을 말한다.

Random 액세스 성능을 향상시키려고 오라클 내부적으로 버퍼 Pinning 테이블 Prefetch 같은 기능을 사용한다.

블록 단위 I/O를 하더라도 한번 액세스할 때 Sequential 방식으로 그 안에 저장된 모든 레코드를 읽는다면 비효율이 없다고 할 수 있다. 반면, 하나의 레코드를 읽으려고 한 블록씩 읽는다면 매우 비효율적이다.

총 읽은 레코드에서 결과 집합으로 선택되는 비중을 선택도라고 한다. 결국 Sequential 액세스 효율은 선택도에 의해 결정된다.

여기서 I/O 튜닝의 핵심 원리 두 가지를 발견할 수 있다. '

-   ` Sequential 액세스의 선택도를 높인다.`

-   `  Random 액세스의 발생량을 줄인다.`

## Sequential 액세스 선택도 높이기

선택도가 매우 낮다면 테이블 Full Scan 비효율이 크다. 테이블을 스캔하면서 읽은 레코드 중 대부분이 필터링되고 일부만 선택된다면 인덱스를 이용하는 게 효과적이다.

## Random 액세스 발생량 줄이기

클러스터링 팩터가 좋을 수록 버퍼 Pinning에 의한 블록 I/O 감소 효과는 더 커진다.

절적한 인덱스구성을 하면 테이블 Random 액세스가 대폭 감소한다.
