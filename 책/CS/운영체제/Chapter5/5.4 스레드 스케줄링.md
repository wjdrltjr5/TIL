# 스레드 스케줄링

프로세스 모델에 스레드를 도입하면서 사용자 수준과 커널 수준 스레드를 구별하였다.

대부분의 최신 운영체제에서 스케줄 되는 대상은 프로세스가 아니라 커널 수준 스레드이다.

사용자 수준 스레드는 스레드 라이브러리에 의해 관리되고 커널은 그들의 존재를 알지 못한다. CPU 상에서 실행되기 위해 LWP를 통한 간접적인 방식일지라도 사용자 수준 스레드는 궁극적으로 연관된 커널 수준 스레드에 사상되어야 한다.

## 5.4.1 경쟁범위

사용자 수준과 커널 수준 스레드의 차이중 하나는 그들이 어떻게 스케줄 되느냐에 있다

다대일과 다대다 모델을 구현하는 시스템에서는(최근 운영체제 x) 스레드 라이브러리는 사용자 수준 스레드를 가용한 LWP 상에서 스케줄한다 이러한 기법은 동일한 프로세스에 속한 스레드들 사이에서 CPU를 경쟁하기 때문에 `프로세스-경쟁-범위(PCS)`로 알려져 있다.

우리가 스레드 라이브러리가 사용자 수준 스레드를 가용한 LWP상에서 스케줄한다고 말하는 경우, 스레드가 실제로 CPU상에서 실행 중이라는 것을 의미하지 않는다.

실제로 CPU 상에서 실행되기 위해서는 운영체제가 LWP의 커널 스레드를 물리적인 CPU 코어로 스케줄 하는 것을 필요로 한다.

CPU 상의 어느 커널 스레드를 스케줄 할 것인지 결정하기 위해서는 커널의 `시스템-경쟁 범위 (SCS)`

SCS 스케줄링에서의 CPU에 대한 경쟁은 시스템 상의 모든 스레드 사이에서 일어난다.

Windows와 Linux 같은 일대일 모델을 사용하는 시스템은 오직 SCS만을 사용하여 스케줄한다.

전형적으로 PCS는 우선순위에 따라 행해진다. 즉 스케줄러는 가장 높은 우선순위를 가진 실행 가능한 프로세스를 선택한다.

사용자 수준 스레드의 우선순위는 프로그래머의 의해 지정되고 스레드 라이브러리에 의해 조정되지 않는다. 그러나 몇몇 스레드 라이브러리는 프로그래머가 스레드의 우선순위를 변경하는 것을 혀용한다.

PCS는 통산 더 높은 우선순위의 스레드를 위하여 현재 실행 중인 스레드를 선점한다는 것을 주의해야 한다.

## 5.4.2 Pthread 스케줄링

스레드를 생성하면서 PCS 또는 SCS를 지정할 수 있는 POSIX Pthread API

-   PTHREAD SCOPE PROCESS 는 PCS 스케줄링을 사용하여 스레드를 스케줄한다.

-   PTHREAD SCOPE SYSTEM 는 SCS 스케줄링을 사용하여 스레드를 스케줄한다.

다대다 모델을 구현하는 시스템에서는 PTHREAD_SCOPE_PROCESS 정책이 사용자 수준 스레드를 기용한 LWP로 스케줄한다.

LWP의 개수는 스레드 라이브러리에 의해 유지되고 아마도 스케줄러 액티베이션 기법이 사용될 수도 있다.

다대다 시스템에서 PTHREAD_SCOPE_SYSTEM 스케줄링 정책은 각 사용자 수준 스레드를 LWP를 생성하고 바인드 하게 될 것이고 결과적으로 일대일 모델을 사용하게 된다.
