# 시스템 콜

`시스템 콜`은 운영체제에 의해 사용 가능하게 된 서비스에 대한 인터페이스를 제공한다.

특정 저수준 작업(ex. 하드웨어를 직접 접근해야 하는 작업)은 어셈블리 명령을 사용하여 작성되어야 하더라도 이러한 호출은 일반적으로 C, C++언어로 작성된 함수 형태로 제공된다.

## 2.3.1 예제

시스템 콜이 어떻게 사용되는지를 설명하는 예

한 파일로부터 데이터를 읽어서 다른 파일로 복사하는 간단한 프로그램을 작성한다고 가정

프로그램이 필요로하는 첫 번째 입력은 두 개의 파일, 입력파일과 출력파일의 이름 이 이름들은 운영체제 설계에 따라 여러 가지 방법으로 지정할 수 있다.

-   한가지 방법은 명령의 일부로 두 파일의 이름을 전달하는 것

입력파일 in.txt를 출력파일 out.txt에 복사

```shell

cp in.txt out.txt
```

-   두 번째 방법은 프로그램이 사용자에게 이름을 요청하는 것.

대화형 시스템에서 이 방법은 일련의 시스템 콜이 필요하다. 먼저 화면에 프롬프트 메시지를 작성한 다음 키보드에서 두 파일의 이름을 지정하는 문자를 읽는다. 마우스 기반 및 아이콘 기반 시스템에서 파일 이름 메뉴는 일반적으로 창에 표시된다.

그런 다음 사용자는 마우스를 사용하여 소스 이름을 선택할 수 있으며 대상 이름을 지정할 수 있는 창을 열 수 있다. 이 일련의 작업을 위해서는 많은 I/O 시스템 콜이 필요하다.

일단 두 개의 파일 이름이 얻어지면, 프로그램은 반드시 입력 파일을 오픈하고 출력 파일을 생성한 후 오픈한다. 각각의 이러한 연산은 또 다른 시스템 콜을 필요로 하며, 각 시스템 콜에서 오류가 발생하면 처리되어야 한다.

## 2.3.2 응용 프로그래밍 인터페이스

대부분의 응용 개발자들은 응용프로그래밍 인터페이스 (API) 에 따라 프로그램을 설계한다.

API는 각 함수에 전달되어야 할 매개변수들과 프로그래머가 기대할 수 있는 반환 값을 포함하여 응용프로그래머가 사용 가능한 집합을 명시한다.

프로그래머는 운영체제가 제공하는 코드의 라이브러리를 통하여 API를 활용한다. UNIX과 Linux 시스템에서 C언어로 작성된 프로그램을 위해서 제공되는 라이브러리는 `libc`로 불린다.

모든 운영체제는 고유의 시스템 콜 이름을 가진다.

막후에서 API를 구성하는 함수들은 통상 응용프로그래머를 대신하여 실제 시스템 콜을 호출한다.

-   Windows함수 CreateProcess()는 실제로 Windows커널의 NTCreateProcess()시스템 콜을 부른다.

왜 실제 시스템 콜을 부르는 것보다 API에 따라 프로그래밍 하는 이유

-   프로그램의 호환성 API에 따라 프로그램을 설계하는 응용프로그래머는 자신의 프로그램이 같은 API를 지원하는 어느 시스템에서건 컴파일을 기대할 수 있다.
-   시스템 콜을 종종 좀 더 자세한 명세가 필요하고 프로그램상에서 작업하기가 API보다 어렵다.

시스템 콜을 처리하는 데 있어 중요한 또 다른 요소는 `실행시간 환경(RTE)`이다.

컴파일러 또는 인터프리터를 포함하여 특정 프로그래밍 언어로 작성된 응용프로그램을 실행하는 데 필요한 전체 소프트웨어 제품군과 라이브러리 또는 로더와 같은 다른 소프트웨어를 가리킨다.

RTE는 운영체제가 제공하는 시스템 콜에 대한 연결고리 역할을 하는 `시스템 콜 인터페이스`를 제공한다. 이 시스템 콜 인터페이스는 API함수의 호출을 가로채어 필요한 운영체제 시스템 콜을 부른다.

각 시스템 콜에는 번호가 할당되고 시스템 콜 인터페이스는 이 번호에 따라 색인되는 테이블을 유지한다. 시스템 콜 인터페이스는 의도하는 시스템 콜을 부르고 시스템 콜의 상태와 반환 값을 돌려준다.

운영체제에 매개변수를 전달하기 위해서 세 가지 일반적인 방법을 사용한다.

-   가장 간단한 방법은 매개변수를 레지스터 내에 전달하는 것 (양이 적을때)
-   매개변수를 메모리 내에 블록이나 테이블에 저장하고 블록의 주소가 레지스터 내에 매개변수로 전달
-   조합해서 사용

매개변수를 프로그램에 의해 스택에 넣어질 수 있고 운영체제에 의해 꺼내진다.

## 2.3.3 시스템 콜의 유형

시스템 콜은 다섯 자기 중요한 범주 즉 `프로세스 제어, 파일 조작, 장치 조작, 정보 유지보수와 통신과 보호 등`으로 묶을 수 있다.

### 프로세스 제어

-   끝내기(end), 중지(abort)
-   적재(load), 수행(execute)
-   프로세스 생성, 프로세스 종료
-   프로세스 속성(attributes) 획득, 프로세스 속성(attributes)설정
-   시간을 기다림
-   이벤트를 기다림, 이벤트를 알림
-   메모리 할당 및 자유화

### 파일 조작

-   파일 생성, 파일 삭제
-   열기, 닫기
-   읽기, 쓰기, 위치 변경
-   파일 속성 획득 및 설정

### 장치 관리

-   장치를 요구, 장치를 방출
-   읽기, 쓰기, 위치변경
-   장치 속성 획득, 장치 속성 설정
-   장치의 논리적 부착 또는 분리

### 정보 유지

-   시간과 날짜의 설정과 획득
-   시스템 데이터의 설정과 획득
-   프로세스, 파일, 장치 속성의 획득
-   프로세스, 파일, 장지 속성의 설정

### 통신

-   통신 연결의 생성, 제거
-   메시지의 송신, 수신
-   상태 정보 전달
-   원격 장치의 부착 및 분리

### 보호

-   get file permissions
-   set file permissions

### Windows와 UNIX 시스템 콜의 예

| 기능 분류         | Windows 함수                     | UNIX 함수    |
| ----------------- | -------------------------------- | ------------ |
| **프로세스 제어** | `CreateProcess()`                | `fork()`     |
|                   | `ExitProcess()`                  | `exit()`     |
|                   | `WaitForSingleObject()`          | `wait()`     |
| **파일 관리**     | `CreateFile()`                   | `open()`     |
|                   | `ReadFile()`                     | `read()`     |
|                   | `WriteFile()`                    | `write()`    |
|                   | `CloseHandle()`                  | `close()`    |
| **장치 관리**     | `SetConsoleMode()`               | `ioctl()`    |
|                   | `ReadConsole()`                  | `read()`     |
|                   | `WriteConsole()`                 | `write()`    |
| **정보 유지**     | `GetCurrentProcessID()`          | `getpid()`   |
|                   | `SetTimer()`                     | `alarm()`    |
|                   | `Sleep()`                        | `sleep()`    |
| **통신**          | `CreatePipe()`                   | `pipe()`     |
|                   | `CreateFileMapping()`            | `shm_open()` |
|                   | `MapViewOfFile()`                | `mmap()`     |
| **보호**          | `SetFileSecurity()`              | `chmod()`    |
|                   | `InitializeSecurityDescriptor()` | `umask()`    |
|                   | `SetSecurityDescriptorGroup()`   | `chown()`    |
