# 도메인 지식 찾아내기

## 비즈니스 문제

비즈니스 문제는 워크플로와 프로세스 최적화, 수작업 최소화, 자원 관리, 의사결정 지원, 데이터 관리 등과 관련한 과제일 수 있다.

비즈니스 문제는 비즈니스 도메인과 하위 도메인의 모든 수준에서 발생할 수 있다. 기업의 목표는 고객의 문제를 해결하는 솔루션을 제공하는 것이다.

하위 도메인은 세분화된 문제 도메인으로 특정 비즈니스 기능에 대한 솔루션을 제공하는 것이 목적이다. 예로 지식 관리 하위 도메인은 정보를 저장하고 추출하는 프로세스를 어음 교환 하위 도메인은 재무 거래 실행 프로세스를 최적화 하는 솔루션을, 회게 하위 도메인은 기업의 자금을 관리하는 솔루션을 제공한다.

## 도메인 지식 찾아내기

효과적인 소프트웨어 솔루션을 설계하려면 적어도 기본적인 비즈니스 도메인 지식이 있어야 한다.

효과적인 소프트웨어는 도메인 전문가가 문제를 생각하는 방식, 즉 멘탈 모델을 모방해야 한다.

비즈니스 문제와 요구사항 이면에 있는 이유에 대한 이해가 없다면 솔루션은 비즈니스 요구사항을 소스코드로 번역한 것에 불과하다.

소프트웨어 프로젝트의 성공은 도메인 전문가와 소프트웨어 엔지니어 간의 효과적인 지식공유에 달렸다. 문제를 해결하려면 문제를 이해해야 한다.

## 커뮤니케이션

소프트웨어 프로젝트가 실패하는 이유에 대한 연구에서 효과적인 커뮤니케이션이 지식 공유와 프로젝트 성공에 필수라는 것을 밝혀냈다.

전형적인 소프트웨어 개발 생애주기에서 도메인 지식은 분석모델로 알려진 엔지니어 친화적인 형태로 변환된다. 분석 모델은 도메인 지식 이면에 존재하는 비즈니스 도메인에 기반하기 보다는 시스템 요구사항을 설명한 것에 지나지 않는다.

의도는 좋을지 모르겠지만 이런식의 중재는 지식을 공유하는데 해를 끼친다. 모든 변환은 정보를 잃게 만든다. 이런 경우 비즈니스 문제 해결에 중요한 도메인 지식은 소프트웨어 엔지니어에게 전달되는 과정에서 손실된다.

이런 현상은 일반적인 소프트웨어 프로젝트에서 변환할 때뿐만 아니라 분석 모델을 소프트웨어 설게 모델(구현 모델 또는 소스코드로 변환되는 소프트웨어 설게 문서)로 변활할 때도 발생한다.

문서화된 커뮤니케이션은 최신 정보를 담아내지 못한다. 결국 소스코드가 나중에 프로젝트를 유지 관리할 소프트웨어 엔지니어에게 까지도 비즈니스 도메인 지식을 전달하는데 사용된다.

도메인지식 ---발견---> 멘탈 모델 ---설계---> 솔루션 모델 ---구현---> 코드

전화 게임에서의 메시지와 마찬가지로 도메인 지식은 종종 왜곡된 상태로 전달된다. 이런 정보는 소프트웨어 엔지니어가 잘못된 솔루션을 구현하게 하거나 솔루션이 올바르다 해도 해결하려는 문제가 잘못된 경우로 이어진다. 어떤 경우은 소프트웨어 프로젝트는 실패한다.

도메인 주도 설계는 도메인 전문가가 소프트웨어 엔지니어게게 지식을 전달하기 위한 방법으로 유비쿼터스 언어를 사용한다.

## 유비쿼터스 언어

유비쿼터스 언어를 사용하는 것은 도메인 주도 설게의 초석이다. 참가자들이 효과적으로 소통하기 위해 변환에 의존하지말고 같은 언어를 사용하는 것이다.

전통적인 소프트웨어 개발 생애주기에서 변환은

-   도메인지식이 분석 모델로
-   분석 모델이 요구사항으로
-   요구사항은 시스템 설계로
-   시스템 설계는 소스코드로

반면에 도메인 주도 설계에서는 이같이 도메인 지식을 계속해서 변환하는 대신, 비즈니스 도메인을 설명하기 위핸 단일화된 언어 체계를 세운다 이것이 유비쿼터스 언어이다.

## 비즈니스 언어

유비쿼터스 언어는 비즈니스 언어라는 점을 강조하고 싶다. 그렇기에 기술 용어는 뺴고 비즈니스 도메인에 관련된 용어로만 구성해야 한다.

### 시나리오

광고 캠페인 관리 시스템을 만들고 있다고 가정하고 다음 문장을 읽어보자.

-   광고 갬페인은 다양한 창의적인 자료를 전시할 수 있다.
-   캠페인은 최소한 하나의 광고 할당이 활성화되어야 게시된다.
-   판매 커미션은 거래가 승인된 후에 회계 처리된다.

모든 문장은 비즈니스 언어로 작성됐다. 반면 다음 문장은 철저하게 기술적이어서 유비쿼터스 언어의 개념에 맞지 않는다. <br>
잘못된 방식

-   광고의 아이프레임(iframe)은 HTML 파일을 표시한다.
-   캠페인은 '활성-활당(active-placement)'테이블에 하나의 연관 레코드가 있어야 게시된다.
-   판매 커미션은 거래(transaction) 테이블과 판매-승인(approved-sales)테이블의 연관 레코드에 근거하여 처리된다.

후자의 문장은 순수하게 기술적이어서 도메인 전문가가 이해하기에 명확하지 않을 것이다.
이러면 개발자는 비즈니스 로직을 완전히 이해할 수 없거나 비즈니스 로직이 왜 그렇게 운영되는지 이해할 수 없어 결국 효과적으로 솔루션을 구현하는 능력이 제한될 것이다.

### 일관성

유비쿼터스 언어는 반드시 정확하고 일관성이 있어야 한다. 가정할 필요가 없어야 하고 비즈니스 도메인 로직을 명료하게 표현해야 한다.

### 모호한 용어

어떤 비즈니스 도메인에서는 정책(policy)라는 용어가 규제 규칙 또는 보험 계약과 같은 여러 의미를 가진다. 정확한 의미는 맥락에 따라 사람 간의 상호작용을 통해서만 알 수 있다. 그러나 소프트웨어는 모호성에 잘 대처하지 못하며, '정책'이라는 개체(entity)를 코드로 모델링하기가 어려울 수 있다.

유비쿼터스 언어는 용어마다 단일 의미를 갖게 하기 때문에 '정책'의 경우 '규제 규칙'과 '보험 계약'의 두 용어를 사용하여 명확한 모델을 만들어야 한다.

### 동의어

유비쿼터스 언어에서 두 용어는 서로 바꿔 사용할 수 없다. 예로 사용자 용어는 도메인 전문가의 언어로 신중하게 설명하면 사용자, 방문자, 관리자, 계정등 다른 용어가 혼용된다.

동의어는 처음에는 해로워 보이지 않는다. 그러나 대부분의 경우 다른 개념을 가진다. 앞의 예제에서 방문자와 계정 모두 기술적으로 시스템의 사용자를 가리킨다. 하지만 대부분의 시스템에서는 미등록 사용자와 등록 사용자는 다른 역할을 가지고 다른 행동을 한다. 방문자 데이터는 주로 분석 목적으로 사용되는 반면 계정은 시스템의 기능을 실제로 사용한다.

특정 컨텍스트 안에서 각각의 용어를 사용하는 것이 바람직하다. 용어의 차이점을 이해해야 간단하고 명확한 모델을 구축하고 비즈니스 도메인 객체의 구현이 가능하다.

## 비즈니스 도메인 모델

### 모델이란 무엇인가?

모델은 실세계의 복제가 아니라 우리가 실제 시스템을 이해하는데 도움을 주는 인간의 창조물이다.

모델을 잘 설명하는 예시 중 하나는 지도다. 길 안내 지도, 지형도, 세계 지도, 지하철 노선도등 모든 지도는 일종의 모델이다.

이 지도 중 어느 것도 우리 행성의 세부적인 것을 모두 나타내지는 않는다. 대신, 각 지도는 특정 목적을 지원하는 데 충분한 자료만 담고 있다.

### 효과적인 모델링

모든 모델에는 목적이 있고 효과적인 모델은 그 목적을 달성하는 데 필요한 세부사항만 포함한다.(이거 객체지향 사실과 오래와 오브젝트에서 말한 객체 협력 같은데.)

예로 세계지도에서는 지하철 정거장 정보를 볼 수 없다. 각 지도는 제공해야 할 정보만을 포함한다.

유용한 모델은 실세계의 복사본이 아니라 문제를 해결하려는 의도가 있어며, 그 목적에 필요한 정보만 제공해야 한다.

모델은 본질적으로 추상화의 결과다. 추상화 개념은 불필요한 상세 정보를 생략하여 복작한 문제를 다룰 수 있게 하고 당면한 문제를 푸는데 필요한 정보만 남게 한다.

반면 비효과적인 추상화는 필요한 정보를 제거하거나 필요 없는 정보를 포함해 잡음을 유발한다.

에츠허르 데이크스트라는 추상화의 목적은 모호함이 아니라 절대적으로 정확할 수 있는 새로운 의미론적 수준을 만드는 것이라고 했다.

### 비즈니스 도메인 모델링

유비쿼터스 언어를 발전시키는 것은 사실상 비즈니스 도메인 모델을 구축하는 셈이다. 모델은 비즈니스가 기능을 어떻게 구현하느냐에 대한 도메인 전문가의 사고 프로세스인 멘탈 모델을 포착해야 한다. 모델은 관련된 비즈니스 엔티티와 그것의 행동, 인과 관계, 불변성 등을 반영해야 한다.

유비쿼터스 언어는 도메인의 모든 가능한 상세 정보를 포함하는 게 아니다. 이는 마치 모든 이해 관계자를 도메인 전문가로 만드려는 것과 같다. 모델은 필요한 시스템을 구현하는 데, 즉 소프트웨어가 해결하고자 하는 특정 문제를 해결하는 데 필요한 만큼의 비즈니스 도메인 관점을 포함하면 된다.

비즈니스 도메인의 이해를 확인할 신뢰성 있는 유일한 방법은 도메인 전문가가 이해할 수 있는 비즈니스 언어로 대화하는 것이다.

### 지속적인 노력

유비쿼터스 언어를 정형화 하려면 언어의 소유자인 도메인 전문가와의 상호작용이 필요하다.
오직 실제 도메인 전문가와의 상호작용만이 비즈니스 도메인에 대한 부정확함이나 잘못된 가정, 또는 전체적인 이해 오류를 발견할 수 있다.

모든 이해관계자는 모든 프로젝트와 관련된 커뮤니케이션에 유비쿼터스 언어를 지속적으로 사용해서 지식 공유를 확산하고 비즈니스 도메인에 대한 공유된 이해를 강화해야한다. 요구사항, 테스트, 문서화, 심지서 소스코드 자체 등 프로젝트 전반에 걸쳐 이 언어를 지속해서 사용해야 한다.

가장 중요한 점은 유비쿼터스 언어를 발전시키는 것은 진행형이라는 것이다. 지속해서 검증하고 발전시켜야 한다.

### 도구

유비쿼터스 언어를 수집하고 관리하는 과정을 돕는 도구와 기술이 있다. 예를 들어 위키는 유비쿼터스 언어를 수집하고 관리하는 용어집으로 사용될 수 있다. 이런 용어집은 새로운 팀원이 쉽게 적응할 수 있게 해준다. (최신화 중요)

다만 용어집은 엔티티의 이름, 과정, 혁할 등의 명사에만 효과적이다. 명사가 중요하긴 하지만 행동을 포착하는 것이 중요하다.

행동은 단순히 명사와 관련된 동사의 목록이 아니라 규칙, 가정, 그리고 불변성을 가진 실제 비즈니스 로직이다.

용어집은 유스케이스 또는 거킨 테스트(Gherkin test)처럼 행동을 포착하는 데 적합한 다른 도구와 함계 사용하는 것이 좋다.

거킨 언어(Gherkin language)로 작성된 자동화 테스트는 유비쿼터스 언어를 포착하리게 좋은 언어일 뿐 아니라 도메인 전문가와 소프트웨어 엔지니어 간극을 메우는 보조 도구로서의 역할을 할 수 있다.

거킨 언어의 작성된 테스트 예시

```
Scenario : 에이전트에게 새로운 지원 케이스에 대해 알린다.
Given : 빈젠트 줄수 는 다음 내용을 담은 새로운 지원 케이스를 제출한다 :
" 나는 AWS Infinidash를 설정하는 데 도움이 필요하다"
When : 티켓이 울프 씨 에게 할당된다.
Then : 에이전트는 새로운 티켓에 대한 알림을 받는다.
```

거킨 기반의 테스트를 관리하는 것은 어렵지만 복잡한 비즈니스 도메인인 경우 확실히 가치가 있다.

### 도전과제

이론상으로 유비쿼터스 언어를 발전시키는 것이 간단한 과정 같지만 실제로는 그렇지 않다. 도메인 지식을 수집하는 신뢰할 만한 유일한 방법은 도메인 전문가와 대화를 하는 것이다. 대부분의 경우 가장 중요한 지식은 암묵지다. 이것은 문서화 되거나 코드로 작성되지 않고 도메인 전문가에 정신에만 존재한다. 유일한 접근 방법은 질문하는것이다.

## 결론

효과적인 커뮤니케이션과 지식 공유는 성공적인 소프트웨어 프로젝트에 필수다. 소프트웨어 엔지니어가 소프트웨어 솔루션을 설계하고 개발하기 위해서는 반드시 비즈니스 도메인을 이해해야 한다.

도메인 주도 설게의 유비쿼터스 언어는 도메인 전문가와 소프트웨어 엔지니어의 지식 간극을 메워주는 효과적인 도구다. 대화, 테스트, 다이어그램, 소스코드 등 프로젝트 전반에 걸쳐 모든 이해관게자가 공유된 언어를 사용함으로써 커뮤니케이션과 지식 공유를 강화한다.

효과적인 커뮤니케이션을 위해서는 유비쿼터스 언어에서 반드시 모호성과 암묵적 가정을 제거해야 한다. 언어의 모든 용어는 일관성이 있어야 하며 모호하지 않고 동의어가 없어야 한다.

프로젝트가 발전함에 따라 더 많은 도메인 지식이 발견된다. 이런 통찰이 유비쿼터스 언어에 반영되는 것이 중요하다.

유비쿼터스 언어를 모든 프로젝트 관련 커뮤니케이션에서 일관되게 사용해야 한다.
