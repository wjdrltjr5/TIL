# 서킷 브레이커
연동 서비스에 과부하가 발생해 응답을 제대로 주지 못하고 있는 상황이라고 해씅ㄹ때 연동 서비스가 정상화 되기 전까지는 요청을 보내도 계속 에러만 발생한다. 또한, 읽기 타임아웃이 발생할 때까지 대기하느라 응답 시간도 길어질 것이다.

연동 서비스가 정상 상태가 아닐때 요청을 보내지 않고 에러를 응답하는 것이 낫다. 이렇게 하면 연동서비스의 문제가 서비스에 주는 영향을 줄일 수 있다.

또한 사용자 입장에서도 수 초를 대기하다가 에러 화면을 보는 것 보다는 빠르게 에러 화면을 보는 편이 낫다.

연동 서비스가 장애 상황일 떄는 연동 대신 바로 에러를 응답하고, 정상화 되었을 때 연동을 재개하면 연동 서비스의 장애가 주는 영향을 줄일 수 있다.

서킷 브레이커가 동작하는 방식이 바로 이와 같다 누전 차단기와 비슷하게 동작한다. 

서킷 브레이커는 닫힘, 열림, 반 열림 3가지 상태를 갖는다. 서킷 브레이커는 닫힘 상태일 때는 모든 요청을 연동 서비스에 전달한다. 외부 연동 과정에서 오류가 발생하기 시작하면, 지정한 임게치를 초과했는지 확인한다.

실패 건수가 임계치를 초과하면 서킷 브레이커는 열림 상태가 된다. 보통 임계치는 다음 조건 중 하나를 사용한다.
- 시간 기준 오류 발생 비율 : 예) 10초 동안 오류 비율이 50% 초과
- 개수 기준 오류 발생 비율 : 예) 100개 요청 중 오류 비율이 50% 초과

열림 상태가 되면 연동 요청은 수행하지 않고 바로 에러 응답을 리턴한다. 열림 상태는 지정된 시간 동안 유지된다. 이시간이 지나면 반 열림 상태로 전환된다. 

반 열림 상태가 되면 일부 요청에 한해 연동을 시도한다. 일정 개수 또는 일정 시간 동안 반 열림 상태를 유지하며, 이 기간동안 연동에 성공하면 닫힘 상태로 복귀한다. 반대로 연동에 실패하면 다시 열림 상태로 전환되어 연동을 차단한다.

서킷 브레이커가 열려 있는 동안은 연동 서비스에 요청이 전달되지 않기 때문에 연동 서비스가 과부하 상황에서 벗어날 수 있는 기회도 생긴다.