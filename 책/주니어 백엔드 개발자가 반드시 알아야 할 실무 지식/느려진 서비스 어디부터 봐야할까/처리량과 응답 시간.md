# 처리량과 응답시간

## 응답시간

응답시간은 사용자의 요청을 처리하는 데 걸리는 시간을 의미한다.

클라이언트(앱이나 브라우저)가 서버로 요청을 보내는 과정은 크게 2단계로 이루어진다.
- 서버에 연결 : TCP를 이용해서 서버에 연결한다.
- 데이터 전송 : 정해진 규칙(프로토콜)에 따라 데이터를 서버에 전송한다. ex. HTTP 프로토콜에 따라 POST 방식으로 JSON 데이터를 보낼 수 있다.

서버는 로직을 실행한 다음에 응답 데이터를 클라이언트에 전송한다. 응답 데이터를 전송할 떄는 API 요청 과정에서 서버와 연결된 소켓을 이용한다.

응답 시간은 다음과 같이 2가지로 나누어 측정하기도 한다.
- TTFB(Time to First Byte) : 응답 데이터 중 첫 번째 바이트가 도착할 때까지 걸린 시간

- TTLB(Time to Last Byte) : 응답 데이터의 마지막 바이트가 도착할 때까지 걸린 시간

응답 데이터의 크기가 작다면 TTFB와 TTLB의 차이가 크지 않다. 하지만 파일 다운로드처럼 전송할 데이터가 크거나 네트워크 속도가 느리면 TTFB와 TTLB의 차이가 커질 수 있다.

따라서 서버 성능을 올바르게 평가하려면 데이터 특성이나 네트워크 환경을 고려해 적절한 지표를 선택해 측정해야 한다.

응답 시간이 사업에 주는 영향은 크다.
- 100ms 지연 시 : 검색 횟수 0.2% 감소
- 400ms 지연 시 : 검색 횟수 0.6% 감소

서버 처리 시간은 다음과 같은 요소를 포함한다.
- 로직 수행(if, for등)
- `DB연동(SQL 실행)`
- `외부 API 연동`
- 응답 데이터 생성(전송)

이중에서도 DB 연동과 외부 API 연동이 큰 비중을 차지한다. 응답 시간을 줄일 때 DB 연동과 API 연동 시간에 집중한다.

## 처리량
처치랼은 단위 시간당 시스템이 처리하는 작업량을 의미하는데 흔히 TPS나 RPS로 처리량을 나타낸다.

- TPS (transaction per second)
- RPS (request per second)

응답 시간의 증가는 사용자 이탈로 이어질 수 있다. 이를 방지하려면 다음 2가지 방법을 고려해야 한다.
- 서버가 동시에 처리할 수 있는 요청 수를 늘려 대기 시간 줄이기
- 처리 시간 자체를 줄여 대기 시간 줄이기

성능을 개선하려면 먼저 현재 서버의 TPS와 응답 시간을 알아야 한다. 트래픽이 많은 시간대의 TPS와 응답 시간이 얼마인지 측정하고, 이 결과를 바탕으로 목표 TPS와 응답 시간을 설정하고 효과적인 성능 개선안을 도출해야 한다.

TPS를 확인하는 가장 간단한 방법은 모니터링 시스템을 활용하는 것이다. 스카우터, 핀포인트, 뉴렐릭 같은 도구를 사용하면 실시간 TPS뿐 아니라 과거 특정 시점의 TPS도 확인할 수 있다.