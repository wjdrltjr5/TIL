# 언제 어떤 방법을 택할까
논블로킹 IO나 가상 스레드를 적용할 때는 다음을 검토해야 한다.
- 문제가 있는가?
- 문제가 있다면 네트워크 IO 관련 성능 문제인가?
- 구현 변경이 가능한가?

가장 먼저 컴토해야 할 점은 성능 문제가 있는지 여부다. 성능 문제가 없다면 또는 당분간 트래픽 증가 가능성이 없다면 논블로킹IO나 가상 스레드를 검토할 필요가 없다 (코드가 복잡하지고 유지보수 난이도만 올라간다.)

성능문제가 있다면 그 문제가 네트워크 IO와 관련된 자원 문제인지 확인해야 한다. 트래픽은 그대로인데 DB 쿼리 시간이 느려지면서 응답시간이 길어지는 문제라면 논블로킹IO나 가상 스레드를 적용해도 개선 효과는 없다. (CPU 중심 작업도 마찬가지)

문제가 IO 관련이라면 그때는 구현 변경이 가능한지를 따져봐야 한다. 예로 동시에 요청하는 클라이언트 수가 늘어나면서 실행되는 스레드 수도 많아지고 메모리 사용률이 98%까지 올라갔다고 했을 때 

위 상황이 지속되면 장애가 발생할 수 있다. 가상 스레드를 적용할 수 있다면 이를 사용하는 것만으로 메모리 사용률을 줄일 수 있다. 가상 스레드를 적용할 수 없다면 일단 메모리를 늘리거나 서버를 수평 확장해서 문제를 완화하는 수 밖에 없다.

만약 우선순위에 밀려 구현 변경이 불가능하다면 그떄는 서버를 일단 확장하고 추후에 개선한다. 

우선순위 뿐만 아니라 기술에 대한 익숙함도 구현 변경 여부에 영향을 준다. 개발자가 관련 기술을 모르면 성능 개선은 어렵다.

정리하면
- 문제가 있고 네트워크 IO와 관련이 있고
- 구현 변경이 가능한 상황일떄 변경을 시도하자.

