# 잠금 사용 시 주의 사항
## 잠금 해제하기
잠금을 획득한 뒤에는 반드시 잠금을 해제해야 한다. 그렇지 않으면 잠금을 시도하는 스레드가 무한정 대기하게 된다. 세마포어도 마찬가지다. 잠금을 사용할 때는 습관적으로 finally 블록에서 잠금을 해제하는 코드를 작성하자.

## 대기시간 지정하기
잠금 획득을 시도하는 코드는 잠금을 구할 수 있을 때까지 계속 대기하는데 동시 접근이 많아지면 대기 시간이 길어지는 문제가 발생할 수 있다.

```java
boolean acquired = lock.tryLock(5, TimeUnit.SECONDS);
if(!acquire){
    // 잠금 획득 실패
    throw new RuntimeException("Failed to acquire lock");
}

// 잠금 획득 성공
try{
    // 자원 접근 코드 실행
}finally{
    lock.unlock();
}
```

위 코드에서 tryLock() 메서드는 5초동안 잠금 획득을 시도한다. 5초 이내에 잠금을 획득하면 true를 반환하고 실패하면 false를 반환한다.

대기 시간 없이 바로 결과를 반환하는 tryLock() 메서드도 사용할 수 있다.

```java
boolean acquired = lock.tryLock();
if(!acquired){
    // 잠금 획득 실패
    throw new RuntimeException("Failed to acquire lock");
}
```

일정 시간 내에 또는 바로 잠금 획득에 실패하면 사용자에게 빠르게 실패 응답을 줄 수 있다. 이는 긴 대기가 초래하는 불안감을 줄어주어 사용자를 안심시키는 데 도움이 된다.

## 교착 상태 피하기
교착 상태는 2개 이상의 스레드가 서로가 획득한 잠금을 대기하면서 무한히 기다리는 상황을 말한다.

교착상태가 발생하지 않도록 신경 써야 하지만, 복잡한 코드 구조에서 잠금을 사용하면 개발자 자신도 모르게 교착상태 상황이 발생할 수 있다. 교착 상태를 해소할 수 있는 방법 중 하나는 잠금 대기 시간을 제한하는 것이다.

잠금 대기 시간을 5초로 제한하면 교착 생태가 발생하더라도 5초 뒤에 잠금 획득에 실패하면서 교착 상태가 풀리게 된다.

교착 상태 발생을 줄이는 다른 방법은 지정한 순서대로 잠금을 획득하는 것이다. 

