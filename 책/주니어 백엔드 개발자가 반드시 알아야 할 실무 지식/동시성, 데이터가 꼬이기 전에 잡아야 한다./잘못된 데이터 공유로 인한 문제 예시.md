# 잘못된 데이터 공유로 인한 문제 예시

```java
public class PayService{
    private Long payId;

    public PayResp pay(PayRequest req){
        ...
        this.payId = getPayId(); // 단계 1
        saveTemp(this.payId, req); // 단계 2
        PayResp resp = sendPayData(this.payId, ...); // 단계 3
        applyResponse(resp); // 단계 4
        return resp;
    }

    private void applyResponse(PayResp resp){
        PayData payData = createPayDataFromResp(resp); // 단계 4-1
        updatePayData(this.payId, payData); // 단계 4-2
    }
}
```

이 코드에서 문제가 되는 것은 payId 필드다. PayService 인스턴스가 하나뿐인 싱글톤 객체라면 다중 스레드 환경에서 인스턴스 변수의 값이 계속해서 달라진다.

DB도 동시성 문제에서 자유롭지 않다 동시성을 고려하지 않으면 데이터 일관성에 문제가 생길 수 있다.

