# 배치 전송
배치 전송은 데이터를 비동기로 연동하는 가장 전통적인 방법이라고 할 수 있다. 메시징 시스템이 거의 실시간으로 데이터를 연동한다면, 배치는 일정 간격으로 데이터를 전송한다.

배치로 전송하는 전형적인 실행 과정은 다음과 같다.
- DB에서 전송할 데이터를 조회한다.
- 조회한 결과를 파일로 기록한다.
- 파일을 연동 시스템에 전송한다.

파일 전송은 FTP나 SFTP같은 파일 전송 프로토콜 혹은 SCP와 같은 명령어를 이용해 수행한다. 주로 사용하는 파일 형식은 다음과 같다.
- 값1(구분자)값2(구분자)값3(구분자)값4
- 이름1 = 값1 이름2= 값2 이름3=값3 이름4=값4
- JSON 문자열

파일로 데이터를 주고받는 시스템은 형식 외에도 다음 항목들을 함께 정해야 한다.
- 송수신 주체
- 시간
- 경로

배치 파일은 데이터 누락 등 오류에 대응할 수 있는 시간을 벌기 위해 근무가 시작되는 오전 시간대에 전송을 처리할 때가 많다.

생산자가 소비자로 파일을 업로드할 경우 소비자는 다음과 같은 방식으로 동작한다.

- 지정한 경로에 파일이 존재하는지 확인한다.
- 파일이 존재하면 파일로부터 데이터를 읽어온다.
- 파일이 없으면 알맞게 후처리한다.
- 읽어온 데이터를 시스템에 반영한다.
- 처리를 완료한 파일은 다른 폴더로 옮긴다.

배치 전송의 또 다른 방식은 읽기 전용으로 DB를 열어주는 것이다. 같은 조직 내에서 데이터를 전달할 때 이방식을 사용할 수 있다. 한 조직 내에서의 데이터 전송은 외부에 데이터를 전송하는 것과 비교하면 상태적으로 보안에 덜 엄격하다.

이떄는 읽기 전용으로 권한을 주어 DB에 직접 접근하게 할 수도 있다. 개발 시간이 부족할 때 선택할 수 있는 방법이다.

## 재처리 기능 만들기
파일을 지정한 시간에 전송하지 못할 때가 있다. 파일을 생성하는 과정에서 오류가 발생하거나, 네트워크 상태가 좋지 않아 전송하지 못하는 경우도 있다.

어떤 이유에서든 전송에 실패하면 일정 시간 후에 재전송하는 기능을 구현해 두자. 

재시도를 했음에도 실패하는 경우도 있다. 이럴 때를 대비해서 수동으로 배치를 쉽게 실행할 수 있도록 명령어나 API를 만들어 두면 문제가 생겼을 때 빠르고 편하게 배치를 재실행 할 수 있다.




