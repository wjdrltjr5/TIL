# CDC(Change Data Capture)

CDC : 변경된 데이터를 추적하고 판별해서 변경된 데이터로 작업을 수행할 수 있도록 하는 소프트웨어 설계 패턴

오라클이나 MySQL 같은 DBMS는 데이터가 변경되면 그 변경 내용을 통지하는 기능을 제공한다. CDC는 이 기능을 활용해서 구현한다.

DML쿼리를 실행하면 DB의 데이터가 변경된다. DB는 변경된 데이터를 CDC처리기에 전송한다.

DB는 커밋된 데이터만 변경된 순서에 맞게 전달한다. CDC처리기에는 롤백된 데이터가 전달되지 않는다. 또한 잘못된 순서로 데이터가 전달되는 일도 없다.

변경 데이터는 레코드 단위로 전달된다. ex) 1개 레코드를 추가하고 2개 레코드를 수정한 다음 3개 레코드를 삭제한다면 6개 레코드에 대한 변경분이 CDC처리기에 전달된다.

이 변경분 데이터는 추가인지 수정인지 삭제인지를 구분할 수 있는 플래그를 갖는다.

CDC처리기는 전달받은 변경 데이터를 확인하고 가공한 뒤에 대상 시스템에 전파한다. 이 CDC처리기는 크게 2가지 형태로 대상 시스템에 변경 데이터를 전파한다.

- 변경 데이터를 그대로 대상 시스템에 전파
- 변경 데이터를 가공/변환해서 대상 시스템에 전파


목적에 따라 CDC 처리기는 DB, 메시징 시스템, API등 다양한 대상에 데이터를 전파할 수 있다.

두 시스템 간 데이터 동기화가 목적이라면 단순히 DB와 DB사이에 CDC를 두어 데이터를 복제할 수 있다.

메시징 시스템에 데이터를 전파하면 여러 시스템에 변경된 데이터를 전달할 수 있어 확장에 유리하다.

## CDC와 데이터 위치
CDC 처리기는 변경 데이터를 어디까지 처래했는지 기록해야 한다. MySQL의 경우 바이너리 로그를 이용해서 CDC를 구현하는데 각 로그 항목은 변경된 데이터와 로그 파일에서의 위치값을 갖는다.

이 위치를 기록해야 CDC처리기를 재시작할 때 마지막으로 조회한 로그부터 읽어올 수 있다.

## CDC가 유용할 때
시스템이 복잡해서 연동 코드를 넣기 부담스러울 때 CDC를 유용하게 활용할 수 있었다. 코드를 수정하지 않고도 CDC를 사용해 타 시스템에 관련 데이터를 전파할 수 있다.


