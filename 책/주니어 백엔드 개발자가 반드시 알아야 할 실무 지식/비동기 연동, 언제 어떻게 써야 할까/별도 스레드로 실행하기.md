# 별도 스레드로 실행하기
비동기 연동을 하는 가장 쉬운 방법은 별도 스레드로 실행하는 것이다.
```java
public OrderResult placeOrder(OrderRequest req){
    ... // 주문 생성 처리

    // 별도 스레드를 이용해서 푸시를 비동기로 발송
    new Thread(() -> pushClient.sendPush(pushData)).start();

    return successResult(...); // 푸시 발송을 기다리지 않고 리턴
}
```

매번 스레드를 생성하는 대신 스레드 풀을 사용하는 방법도 있다.

```java
ExecutorService executor = Executors.newFixedThreadPool(50);
...

    public OrderResult placeOrder(OrderRequest req){
        ..// 주문 생성 처리

        // 스레드 풀을 이용해서 푸시를 비동기로 발송
        executor.submit(() -> pushClient.sendPush(pushData));

        return successResult(...); // 푸쉬 발송을 기다리지 않고 리턴
    }
```

프레임 워크가 제공하는 비동기 기능을 사용하는 방법도 있다. 
```java
public class PushService{

    @Async
    public void sendPushAsync(PushData pushData){
        pushClient.sendPush(pushData);
    }
}
```

@Async 애노테이션을 사용할때는 메서드 이름에 비동기 실행과 관련된 단어를 추가하는 것이 좋다. (호출하는 쪽에서 인식할 수 있도록)

```java
public OrderResult placeOrder(OrderRequest req){
    // 주문 생성 처리

    pushService.sendPush(pushData);

    return successResult(...);
}
```
위 처럼 작성되어 있으면 sendPush메서드가 비동기로 실행된다는 사실을 알아채기 힘들다. 비동기 실행을 모르고 try-catch로 예외처리 코드를 추가할 수 있다. 하지만 비동기로 처리되기 때문에 예외가 발생해도 catch 할 수 없다.


```java
public OrderResult placeOrder(OrderRequest req){
    // 주문 생성 처리
    try{
        pushService.sendPush(pushData);
    }catch(Exception e){
        // 비동기로 실행되므로 해당 구역은 동작하지 않는다.
    }
    return successResult(...);
}
```

별도 스레드로 실행하면 연동 과정에서 발생한 오류 처리에 더 신경 써야 한다. 예외를 전파해도 소용없기 때문이다. 별도 스레드로 실행되는 코드는 내부에서 연동과정에서 발생한 오류를 직접 처리해야 한다.

```java
@Async
public void sendPushAsync(PushData pushData){
    try{
        pushClient.sendPush(pushData);
    }catch(Exception e){
        try{
            Thread.sleep(500);
        }catch(Exception ex){
        }
        
        try{
            pushClient.sendPush(pushData);// 재시도를 하거나
        }catch(Exception ex){
            // 실패 로그를 남기거나
        }
    }
}
```

> 비동기로 실행할 코드가 외부 API 호출이거나 DB 연동과 같은 네트워크 I/O 작업이라면 자바 언어의 가상스레드나 Go언어의 고루틴을 사용하는 것도 방법이다. 가상스레드는 네이티브 스레드(OS스레드)가 아닌 런타임에서 관리하는 경량 스레드로 적은 메모리를 사용한다.