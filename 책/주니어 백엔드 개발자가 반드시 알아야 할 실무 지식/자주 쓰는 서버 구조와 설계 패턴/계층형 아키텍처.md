# 계층형 아키텍처
계층형 아키텍처는 각 계층마다 특정 역할을 수행하고 하위에 위치한 계층에만 의존하는 특징을 갖는다.

계층형 아키텍처에서 하위 계층은 상위 계층에 대한 의존을 갖지 않는다. 오직 상위 계층에서 하위 계층으로의 의존만 허용한다.

계층형 아키텍처는 바로 하위의 계층에만 의존하도록 강제하는 경우가 있고, 하위에 있는 계층이면 모두 의존을 허용하는 경우도 있다.

계층형 아키텍처는 구조가 단순하고 규칙이 명확하기 때문에 코드 실행 흐름을 추적하기 쉽다는 장점이 있다.

## 흩어지는 도메인 로직
도메인 계층없이 응용 계층과 인프라 계층으로만 구현하는 경우가 많은데 단순히 서비스/DAO로 구성된 계층형 아키텍처를 사용하면 실제로 계층은 3개가 된다. 도메인 영역이 거의 없는 계층 구조에서는 도메인 로직이 인프라와 응용 계층으로 분산되는 경향이 있어 코드 유지보수를 어렵게 만들기도 한다.

다음 쿼리는 쿼리에 도메인 로직이 스며들어간 전형적인 예
```sql
-- MemberDao..updateMemberStatus(id)의 쿼리
update member set status = 20 where member_id = ? and status = 10
```
위 쿼리는 status가 10인 경우에 status를 20으로 바꾼다. 이 쿼리를 실행하는 코드는 다음과 같은 형태를 갖는다.

```java
int cnt = mdao.updateMemberStatus(id);
if(cnt == 0){
     // 변경 건이 없으므로 변경 실패 처리
}
```
이 코드에는 어떤 도메인 로직도 없다. 단지 회원의 상태를 변경하는 DAO메서드를 실행하고 결과 건수가 0이면 변경 실패 처리를 한다.

어떤 조건일 때 상태가 변경되는지 확인하려면 쿼리를 뒤져야 한다. 이것이 도메인 모델이 빈약하거나 없을 때 발생하는 로직 흩어짐 증상이다. 

이렇게 도메인 로직이 쿼리나 컨트롤러와 같은 다른 계층에 흩어지는 것을 방지하려면 도메인 로직을 최대한 한 계층으로 모아야 한다.

도메인 로직을 한 곳에 모으는 방법 중 하나는 DDD전술 패턴을 활용하는 것이다.