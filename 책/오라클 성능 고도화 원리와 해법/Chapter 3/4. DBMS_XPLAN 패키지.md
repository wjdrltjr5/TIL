# DBMS_XPLAN 패키지

오라클 9.2버전에 소개된 dbms_xplan 패키지를 통해 plan_table에 저장된 실행계획을 좀 더 쉽게 출력해 볼 수 있게 되었다.

오라클 10g부터는 라이브러리 캐시에 캐싱돼 있는 SQL 커서에 대한 실행 계획은 물론 Row Source별 수행 통게까지 손쉽게 출력해 볼 수 있도록 기능이 확장되었다.

AWR에 수집된 과거 수행됐던 SQL에 대한 실행계획을 확인하는 것도 가능하다.

## 예상 실행계획 출력

앞에서 스크립트를 이용해 실행 게획을 출력하는 방법

> @?/rdbms/admin/utlxpls

이 스크립트를 열어보면 내부적으로 dbms_xplan 패키지를 호출하고 있는 것을 볼 수 있다.

```sql
select plan_table_output from table(dbms_xplan.display('plan_table', null, 'serial'));
```

첫번째 인자에는 실행계획이 저장된 plan table명을 입력하고 두 번째 인자에는 statement_id를 입력하면된다.

두 번째 옵션이 NULL일 때는 가장 마지막 explain plan 명령에 사용했던 쿼리의 실행계획을 보여준다.

병렬 쿼리에 대한 실행계획을 수집했다면 @?/rdbms/admin/utlxpls 스크립트를 수행함으로써 병렬 항목에 대한 정보까지 볼 수 있다.

그 외에에도 dbms_xplan.display 함수를 직접 쿼리하면 세 번째 인자를 통해 다양한 포맷 옵션을 선택할 수 있다. (여러개 가능)

세 번째 인자 옵션 종류들

-   BASIC
-   ROWS
-   BYTES
-   COST
-   PARTITION
-   PARALLEL
-   PREDICATE
-   PROJECTION
-   ALIAS
-   REMOTE
-   NOTE
-   ALL
-   OUTLINE

## 캐싱된 커서의 실제 실행 계획 출력

커서는 하드 파싱 과정을 거쳐 메모리에 적재된 SQL과 Parse Tree 실행계획, 그리고 그것을 실행하는데 필요한 정보를 담은 SQL Area를 말한다.

오라클은 라이브러리 캐시에 캐싱돼 있는 각 커서에 대한 수행통게를 볼 수 있도록 v$sql 뷰를 제공한다.

이것과 함께 sql_id 값으로 조인해서 사용할 수 있도록 제공되는 뷰가 몇 가지 더 있는데, 그중 활용도가 가장 높은 것이 v$sql_plan과 v$sql_plan_statistics다.

이 두 뷰를 합쳐서 보여주는 것이 v$sql_plan_statistics_all 이다.

## 캐싱된 커서의 Row Source별 수행 통계 출력

SQL문에 gather_plan_statistics 힌트를 사용하거나, 시스템 또는 세션 레벨에서 statistics_level 파라미터를 all로 설정하면 오라클은 실제 SQL을 수행하는 동안의 실행계획 각 오퍼레이션 단계별로 수행 통게를 수집한다.
